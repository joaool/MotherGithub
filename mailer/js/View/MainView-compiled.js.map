{"version":3,"sources":["MainView.js"],"names":[],"mappings":"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","file":"MainView-compiled.js","sourcesContent":["MailerTemplate.Views.MainView = Backbone.View.extend({\r\n\tm_Model : null,\r\n\tm_TemplateItems : null,\r\n\tm_Editor : null,\r\n\tm_PropertyPanel : null,\r\n\tm_DesignPage : null,\r\n\t\r\n\tm_saveTemplate : null,\r\n\tm_jsonGenerator : null,\r\n\tm_loadTemplate : null,\r\n\t\r\n\tinitialize : function(expenses){\r\n\t\tthis.m_jsonGenerator = new JsonGenerator();\r\n\t\t\r\n\t\tthis.m_TemplateItems = new MailerTemplate.Views.TemplateItems({el : \"#templateItems\"});\r\n\t\tthis.m_Editor = new MailerTemplate.Views.TemplateHolder({el : \"#templateHolder\"});\r\n\t\tthis.listenTo(this.m_Editor,MailerTemplate.Views.TemplateHolder.DISPLAY_PROPERTYPANEL,this.ShowProptertyPanel);\r\n\t\tthis.listenTo(this.m_Editor,MailerTemplate.Views.TemplateHolder.BINDMODEL, this.bindModelToPanel);\r\n\t\t\r\n\t\tthis.m_PropertyPanel = new MailerTemplate.Views.PropertyPanel({el : \"#propertyPanel\"});\r\n\t\t\r\n\t\t// this.m_saveTemplate = $(\"#saveTempalate\");\r\n\t\tthis.m_saveTemplate = $(\"#saveTemplate\");\r\n\t\tthis.m_loadTemplate = $(\"#loadTemplate\");\r\n\t\t\r\n\t\tthis.m_DesignPage = new MailerTemplate.Views.PageDesign({el : \"#templateDesign\"});\r\n\t\tthis.listenTo(this.m_DesignPage,MailerTemplate.Views.PageDesign.PROPERTY_CHANGE,this.OnPagePropertyChange);\r\n\t\t\r\n\t\tthis.m_DesignPage.setValues(MailerTemplate.pageStyle);\r\n\t\tthis.m_Editor.setAllPageValues(MailerTemplate.pageStyle);\r\n\t},\r\n\tevents : {\r\n\t\t// \"click #saveTempalate\" : \"OnSaveBtnClick\",\r\n\t\t// \"click #loadTemplate\" : \"OnLoadTemplateBtnClick\"\r\n\t\t\"click #previewTemplate\" : \"OnPreview\",\r\n\t\t\"click #saveTemplate\" : \"OnSaveTemplateBtnClick\",\r\n\t\t\"click #loadTemplate\" : \"OnLoadTemplateBtnClick\",\r\n\t\t\"click #exitNoSave\" : \"OnExitNoSave\"\r\n\t},\r\n\tOnPagePropertyChange: function(data){\r\n\t\tthis.m_Editor.setProperty(data);\r\n\t},\r\n\topenModal: function() {\r\n        var view = new MailerTemplate.Views.ModalView();\r\n\t\tview.setHtml(\"Do you sure you want to save this template ?\")\r\n\t\tthis.listenTo(view,MailerTemplate.Views.ModalView.OkClicked, this.onModalOkClicked);\r\n        var modal = new Backbone.BootstrapModal({\r\n            content: view,\r\n            title: 'Save',\r\n            animate: true\r\n        });\r\n        modal.open(function(){ console.log('clicked OK') });\r\n    },\r\n\tonModalOkClicked : function(){\r\n\t\twindow.open(\"TemplatePreview.html\",\"_blank\");\r\n\t},\r\n\tOnPreview : function(evt){\r\n\t\t// var modelData = this.m_Editor.generatePlainHtml();\r\n\t\tvar modelData = this.m_Editor.getModelData();\r\n\r\n\t\tvar jsonData = this.m_jsonGenerator.GenerateJson(modelData);\r\n\t\tvar jsonString = JSON.stringify(jsonData);\r\n\t\tconsole.log(jsonString);\r\n\t\t// this.openModal();\r\n\t\twindow.jsonObject = jsonData;\r\n\t\t// this.openModal();\r\n\t\twindow.open(\"./mailer/TemplatePreview.html\",\"_blank\");\r\n\t},\r\n\t// OnSaveBtnClick : function(evt){\r\n\t// \tvar modelData = this.m_Editor.getModelData();\r\n\t// \tvar jsonData = this.m_jsonGenerator.GenerateJson(modelData);\r\n\t// \tvar jsonString = JSON.stringify(jsonData);\r\n\t// \tconsole.log(jsonString);\r\n\t// \t// save this jsonString\r\n\t// \tthis.openModal();\r\n\t// \twindow.jsonObject = jsonData;\r\n\t// \t//window.open(\"TemplatePreview.html\",\"_blank\");\r\n\t// },\r\n\tOnSaveTemplateBtnClick: function(){\r\n\t\t// var modelData = this.m_Editor.generatePlainHtml();\r\n\t\tvar modelData = this.m_Editor.getModelData();\r\n\t\tvar jsonData = this.m_jsonGenerator.GenerateJson(modelData);\r\n\t\tconsole.log(\"jsonData.pageStyles.bodyPaddingLeft=\"+jsonData.pageStyles.bodyPaddingLeft);\r\n\t\tconsole.log(\"jsonData.pageStyles.footerPaddingLeft=\"+jsonData.pageStyles.footerPaddingLeft);\r\n\t\t// to overwrite body and footer PageStyles - necessary for old data\r\n\t\tjsonData.pageStyles.bodyPaddingLeft = jsonData.pageStyles.headerPaddingLeft;\r\n\t\tjsonData.pageStyles.footerPaddingLeft = jsonData.pageStyles.headerPaddingLeft;\r\n\t\tjsonData.pageStyles.bodyPaddingRight = jsonData.pageStyles.headerPaddingRight;\r\n\t\tjsonData.pageStyles.footerPaddingRight = jsonData.pageStyles.headerPaddingRight;\r\n\t\t//-----------------------------\r\n\t\tthis.storeTemplateUI(this,jsonData);\r\n\t},\r\n\tOnLoadTemplateBtnClick : function(){\r\n\t\t// var temp = this;\r\n\t\t// $.ajax({\r\n\t\t// \turl : \"TemplateSample.json\",\r\n\t\t// \ttype: 'get',\r\n\t\t// \tdata : 'text',\r\n\t\t// \tsuccess : function(data) { temp.LoadTemplate(data); },\r\n\t\t// \terror : this.OnError\r\n\t\t// });\r\n\t\tthis.loadTemplateUI(this);\r\n\t},\r\n\tOnExitNoSave: function(){\r\n\t\twindow.close();\t\t\r\n\t},\t\r\n\tLoadTemplate : function(data){\r\n\t\ttry{\r\n\t\t\tif(typeof data == 'string')\r\n\t\t\t{\r\n\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t}\r\n\t\t\tthis.m_Editor.LoadJson(data);\r\n\t\t\tif (data.pageStyles){\r\n\t\t\t\tthis.m_DesignPage.setValues(data.pageStyles);\r\n\t\t\t\tthis.m_Editor.setAllPageValues(data.pageStyles);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tconsole.log(\"Json parse Error\")\r\n\t\t}\r\n\t\t\r\n\t},\r\n\tOnError : function(){\r\n\t\tconsole.log(\"Error loading template\");\r\n\t},\r\n\tShowProptertyPanel: function(data){\r\n\t\tthis.m_PropertyPanel.clear();\r\n\t\tthis.m_PropertyPanel.show(data.type,data.model);\r\n\t},\r\n\tbindModelToPanel : function(model){\r\n\t\tthis.m_PropertyPanel.setModel(model);\r\n\t},\r\n\tisTemplateEmpty: function(templateObj){\r\n\t\treturn (templateObj.templateItems.header.length === 0 && templateObj.templateItems.body.length === 0 && templateObj.templateItems.footer.length === 0);\r\n\t},\r\n\tstoreTemplateUI: function(context,jsonData){\r\n\t\tvar spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\tvar thiz=context;\r\n\t\tvar promise=FL.API.loadTableId(\"_templates\");\r\n\t\tpromise.done(function(data){\r\n\t\t\tspinner.stop();\r\n\t\t\tvar arrOfObj = thiz.convertsIdsToArrOfObj(data); //converts templateOptionsArr to arrOfObjects\r\n\t\t\t//ex:arrOfObj=[{value:1,text: \"t 115\",template:\"dfdfdg\"},{value:2,text: \"t 116\",template:\"dfgd\"}]\r\n\t\t\tthiz.storeTemplateForm(jsonData,arrOfObj);\r\n\t\t});\r\n\t\tpromise.fail(function(err){\r\n\t\t\tspinner.stop();\r\n\t\t\talert(\"OnSaveTemplate unable to load templates Error=\"+err);\r\n\t\t\treturn;\r\n\t\t});\r\n\t},\r\n\tstoreTemplateForm: function(jsonData,arrOfObj){//store jsonData on server eventually overlaping one of existing arrOfObj\r\n\t\tvar jsonString = JSON.stringify(jsonData);\r\n\t\tvar selectedTemplateName = null;\r\n\t\tif (this.isTemplateEmpty(jsonData)){\r\n\t\t\tFL.common.makeModalInfo('No template to save. Build a template before saving it.');\r\n\t\t}else{\r\n\t\t\tvar masterDetailItems = {\r\n\t\t\t\tmaster:{name:\"\"},\r\n\t\t\t\tdetail:{}\r\n\t\t\t};\r\n\t\t\tvar options = {\r\n\t\t\t\ttype:\"primary\",\r\n\t\t\t\ticon:\"pencil\",\r\n\t\t\t\tbutton1:\"Cancel\",\r\n\t\t\t\tbutton2:\"Save this template\",\r\n\t\t\t\tdropdown:{\r\n\t\t\t\t\t\"_templateForm_template\":{\r\n\t\t\t\t\t\tarr:arrOfObj,//titles,\r\n\t\t\t\t\t\tdefault:\"Not overwriting any template\",\r\n\t\t\t\t\t\tonSelect:function(objSelected){\r\n\t\t\t\t\t\t\t// alert(\"Template selected =>\"+JSON.stringify(objSelected));\r\n\t\t\t\t\t\t\tselectedTemplateName = objSelected.text;\r\n\t\t\t\t\t\t\t$(\"#_templateForm_name\").val('');//if user wants to overwrite, name is cleared\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tFL.common.editMasterDetail(\"B\",\" Save the current template\",\"_templateForm\",masterDetailItems,options,function(result){\r\n\t\t\t\tif(result){\r\n\t\t\t\t\tvar name = $(\"#_templateForm_name\").val();\r\n\t\t\t\t\t// var template = $(\"#_templateForm_template ul\").text();\r\n\t\t\t\t\tif(selectedTemplateName)\r\n\t\t\t\t\t\tname = selectedTemplateName;\r\n\t\t\t\t\tvar record = {jsonTemplate:jsonString};\r\n\t\t\t\t\tvar promise = FL.API.upsertByKey(name,\"_templates\",record);//\"_id\"yField,keyFieldValue,entityName,record\r\n\t\t\t\t\tpromise.done(function(){\r\n\t\t\t\t\t\tconsole.log(\"OnSaveTemplate storeTemplateInterface upsertByKey SUCCESS !\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpromise.fail(function(err){\r\n\t\t\t\t\t\talert(\"OnSaveTemplate storeTemplateInterface upsertByKey\tFAILURE\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// alert(\"-->Nope\");//the user select close\r\n\t\t\t\t\tFL.common.makeModalInfo('Nothing was saved');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tloadTemplateUI: function(context){\r\n\t\tvar spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\tvar thiz=context;\r\n\t\tvar promise=FL.API.loadTableId(\"_templates\",\"jsonTemplate\");\r\n\t\tpromise.done(function(data){\r\n\t\t\tspinner.stop();\r\n\t\t\tif( data.length === 0 ){\r\n\t\t\t\tFL.common.makeModalInfo('No templates available. You must have at least one template saved.');\r\n\t\t\t}else{\r\n\t\t\t\tvar selectedTemplatePromise = thiz.loadTemplateForm(data);\r\n\t\t\t\tselectedTemplatePromise.done(function(selectedTemplate){\r\n\t\t\t\t\tconsole.log(\">>>>>OnLoadTemplateBtnClick selectedTemplatePromise SUCCESS <<<<< \");\r\n\t\t\t\t\tif(selectedTemplate){//a specific template was selected\r\n\t\t\t\t\t\tdata = JSON.parse(selectedTemplate);\r\n\t\t\t\t\t\tthiz.m_Editor.LoadJson(data);\r\n\t\t\t\t\t\tif (data.pageStyles){\r\n\t\t\t\t\t\t\tthiz.m_DesignPage.setValues(data.pageStyles);\r\n\t\t\t\t\t\t\tthiz.m_Editor.setAllPageValues(data.pageStyles);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}else{//no template was choosen (selectedTemplate=null)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tselectedTemplatePromise.fail(function(err){console.log(\">>>>>OnLoadTemplateBtnClick selectedTemplatePromise FAILURE <<<<<\"+err);return def.reject(err);});\r\n\t\t\t}\r\n\t\t});\r\n\t\tpromise.fail(function(err){\r\n\t\t\tspinner.stop();\r\n\t\t\talert(\"DefaultGridWithNewsLetterAndEditButtons Error=\"+err);\r\n\t\t});\r\n\t},\r\n\tloadTemplateForm: function(templateOptionsArr){//returns a promise\r\n\t\tvar def = $.Deferred();\r\n\t\tvar arrOfObj = this.convertsToArrOfObj(templateOptionsArr); //converts templateOptionsArr to arrOfObjects\r\n\t\t//ex:arrOfObj=[{value:1,text: \"t 115\",template:\"dfdfdg\"},{value:2,text: \"t 116\",template:\"dfgd\"}]\r\n\r\n\t\tvar selectedTemplate = null;\r\n\t\tvar masterDetailItems = {\r\n\t\t\tmaster:{name:\"\"},\r\n\t\t\tdetail:{}\r\n\t\t};\r\n\t\tvar options = {\r\n\t\t\ttype:\"primary\",\r\n\t\t\ticon:\"cloud-download\",\r\n\t\t\tbutton1:\"Cancel\",\r\n\t\t\tbutton2:\"Ok to Load\",\r\n\t\t\tdropdown:{\r\n\t\t\t\t\"_loadTemplateForm_name\":{\r\n\t\t\t\t\tarr:arrOfObj,//titles,\r\n\t\t\t\t\tdefault:\"No template\",\r\n\t\t\t\t\tonSelect:function(objSelected){\r\n\t\t\t\t\t\t// alert(\"Template selected =>\"+JSON.stringify(objSelected));\r\n\t\t\t\t\t\tselectedTemplate = objSelected.template;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tFL.common.editMasterDetail(\"B\",\" Load an existing template\",\"_loadTemplateForm\",masterDetailItems,options,function(result){\r\n\t\t\tif(result){\r\n\t\t\t\tvar template = $(\"#_loadTemplateForm_option\").text();\r\n\t\t\t\tif(template.trim() == \"No template\"){\r\n\t\t\t\t\tFL.common.makeModalInfo('No template was loaded.');\r\n\t\t\t\t\treturn def.resolve(null);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// alert(\"loadTemplateInterface template=\"+template);\r\n\t\t\t\t\treturn \tdef.resolve(selectedTemplate);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t// alert(\"-->Nope\");//the user select close\r\n\t\t\t\treturn def.resolve(null);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn def.promise();\r\n\t},\r\n\tconvertsToArrOfObj: function(templateOptionsArr){\r\n\t\t//receives [{\"_id\": \"t 115\",jsonTemplate:\"dfdfdg\"},{\"_id\": \"t 116\",jsonTemplate:\"dfgd\"}] and returns [{value:1,text: \"t 115\",template:\"dfdfdg\"},{value:2,text: \"t 116\",template:\"dfgd\"}]\r\n\t\treturn _.map(templateOptionsArr, function(el,index){ return {\"value\":index+1,\"text\":el._id,\"template\":el.jsonTemplate}; });\r\n\t},\r\n\tconvertsIdsToArrOfObj: function(templateOptionsArr){\r\n\t\t//receives [{\"_id\": \"t 115\"},{\"_id\": \"t 116\"}] and returns [{value:1,text: \"t 115\"},{value:2,text: \"t 116\"}]\r\n\t\treturn _.map(templateOptionsArr, function(el,index){ return {\"value\":index+1,\"text\":el._id}; });\r\n\t}\r\n});\r\nwindow.onbeforeunload = function() {\r\n\treturn 'Do you want to leave FrameLink Newsletter editor without saving ?';\r\n};\r\n\r\n\r\n"]}