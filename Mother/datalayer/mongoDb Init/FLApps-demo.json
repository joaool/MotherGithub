var fl = new flDico();
var flD = new flData();
var custCN;
var orderCN;
var lineOrdCN;
var prodCN;

var nbCusts=50;
var nbOrders=100;
var nbLinesPerOrder=3;
var nbProds=10;

// Collection Customers
var rsl = fl.entityAdd({"singular":"Customer", "plural":"Customers", "description":"All my customers" });
custCN = rsl.j.entityCN;
fl.fieldAdd({entityCN:custCN, name:"name",description:"name of customer",typeUI:"textBox"});
fl.fieldAdd({entityCN:custCN, name:"city",description:"city of customer",typeUI:"textBox"});
fl.fieldAdd({entityCN:custCN, name:"phone",description:"customer's phone",typeUI:"textBox"});

for (i=0; i<nbCusts; i++){
	var j={};
	j["_id"] = i;
	j[new String(nbCusts+1)]= "Client-"+ i;
	j[new String(nbCusts+2)]= "City "+ i;
	j[new String(nbCusts+3)]= "0033 "+ i+i+i+i;
	
	printjson(j);
	flD.insert(custCN, j);
}

var rsl = fl.entityAdd({"singular":"Order", "plural":"Orders", "description":"Order collection" });
orderCN=rsl.j.entityCN;
fl.fieldAdd({entityCN:orderCN, name:"date",description:"order's date",typeUI:"textBox"});
fl.fieldAdd({entityCN:orderCN, name:"amount",description:"total amount",typeUI:"textBox"});
fl.fieldAdd({entityCN:orderCN, name:"shipped",description:"is it shipped",typeUI:"textBox"});

var rlt = fl.relationAdd({"relationName":"CustomerCanOrder",
			 "left":{"entityCN":custCN, "verb":"orders", "side":0, "cardinality":"1", "storeRelation":false, "cache":false, "format":""},
			 "right":{"entityCN":orderCN, "verb":"is ordered by", "side":1, "cardinality":"N", "storeRelation":true, "cache":false, "format":""}
			 });
var rlt = fl.relationAdd({"relationName":"CustomerReceiveOrder",
			 "left":{"entityCN":custCN, "verb":"receives physicel", "side":0, "cardinality":"1", "storeRelation":false, "cache":false, "format":""},
			 "right":{"entityCN":orderCN, "verb":"ordered to be physical delivered to", "side":1, "cardinality":"N", "storeRelation":true, "cache":false, "format":""}
			 });
var relCN=rlt.j.cn;

var rsl = fl.entityAdd({"singular":"orderLine", "plural":"orderLines", "description":"lines of order" });
lineOrdCN=rsl.j.entityCN;
fl.fieldAdd({entityCN:lineOrdCN, name:"quantity",description:"quantity ordered",typeUI:"textBox"});
fl.fieldAdd({entityCN:lineOrdCN, name:"product",description:"product ID not linked yet",typeUI:"textBox"});
fl.fieldAdd({entityCN:lineOrdCN, name:"price",description:"total price of the line",typeUI:"textBox"});

for (i=1; i<nbOrders; i++) {
	dt=new Date("2014/03/27");
	var j={};
	j["_id"] = i;
	j[new String (orderCN+1)]= dt;
	j[new String (orderCN+2)]= 123456.45;
	j[new String (orderCN+3)]= false;
	dataInsert(orderCN, j);
	
	for (k=1; k<nbLinesPerOrder; k++){
		var jl={};
		jl[new String(lineOrdCN+1)]=k;
		jl[new String(lineOrdCN+2)]="prod-"+(i+k);
		jl[new String(lineOrdCN+3)]=123.45;
		
		flD.insert(lineOrdCN, jl);
	}
}
var rlt = fl.relationAdd({"relationName":"OrderToLines",
			 "left":{"entityCN":orderCN, "verb":"has", "side":0, "cardinality":"1", "storeRelation":false, "cache":false, "format":""},
			 "right":{"entityCN":lineOrdCN, "verb":"belongs to", "side":1, "cardinality":"N", "storeRelation":true, "cache":false, "format":""}
			 });

var rsl = fl.entityAdd({"singular":"Product", "plural":"Products", "description":"Catalog" });
prodCN=rsl.j.entityCN;
fl.fieldAdd({entityCN:prodCN, name:"name",description:"product name",typeUI:"textBox"});
fl.fieldAdd({entityCN:prodCN, name:"family",description:"product family",typeUI:"textBox"});
fl.fieldAdd({entityCN:prodCN, name:"price",description:"product price",typeUI:"textBox"});

for (i=1; i<nbProds; i++) {
	var j={};
	var ty = i % 4;
	j["_id"]=i;
	j[new String(prodCN+1)]="prod-"+i;
	j[new String(prodCN+2)]="test-" + ty; 
	j[new String(prodCN+3)]=456.98;

	flD.insert(prodCN, j);
}
var rlt = fl.relationAdd({"relationName":"ProdToLines",
			 "left":{"entityCN":prodCN, "verb":"belongs to", "side":0, "cardinality":"1", "storeRelation":false, "cache":false, "format":""},
			 "right":{"entityCN":lineOrdCN, "verb":"has", "side":1, "cardinality":"N", "storeRelation":true, "cache":false, "format":""}
			 });

fl.entityGet( {"entityCN":"00"} );
// get an array of user defined Entity

fl.entityGetAll( {$where:"this._id.length > 1"} );

fl.fieldGet({fieldCN:add(custCN)});

fl.fieldGetAll({entityCN:custCN});
fl.fieldGetByName({entityCN:custCN, name:"city"});
fl.fieldGetAllByName({name:"name"})

fl.relationGet({relationCN:relCN});

flD.get("00", 5);
