{"version":3,"sources":["FLGrid2.js"],"names":[],"mappings":"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","file":"FLGrid2-compiled.js","sourcesContent":["// jQuery(document).ready(function($){\r\n\t/**\r\n\t* data dictionary UI methods \r\n\t*/\r\n\t// FL = FL || {}; //gives undefined if FL is undefined \r\n\t// FL = {};\r\n\t// // a=\"A\";\r\n\t// b=\"B\";\r\n\t// var a = (typeof a === 'undefined') ? b : a;//if a is defined returns \"A\" otherwise returns the content of b\r\n\t// alert(\"zzz=\"+a);//sets \"B\"\r\n\r\n\tFL = (typeof FL === 'undefined') ? {} : FL;\r\n\tFL[\"grid\"] = (function(){//name space FL.grid\r\n\t\tvar prepareAttributesArr = function(headerstring){\r\n\t\t\t// var attributesArr = [];\r\n\t\t\tvar colHeaderArr = headerstring.split(\",\");\r\n\t\t\tvar attributesArr = _.map(colHeaderArr,function(el){\r\n\t\t\t\treturn {name: el,description: el + \"'description\",label: el,type: \"string\", typeUI: \"textbox\", enumerable: null, key: false};\r\n\t\t\t});\r\n\t\t\treturn attributesArr;\r\n\t\t};\r\n\t\tvar prepareOneEmptyRowArray = function(arrOfColumns){\r\n\t\t\tvar emptyObj = {};\r\n\t\t\t_.each(arrOfColumns,function(element){\r\n\t\t\t\temptyObj[element.name] = \"\";\r\n\t\t\t});\r\n\t\t\t// return {name: el,description: el + \"'description\",label: el,type: \"string\", typeUI: \"textbox\", enumerable: null, key: false};\r\n\t\t\treturn [emptyObj];\r\n\t\t};\r\n\t\tvar injectId = function(idTitle,arrOfColumns){//injects a first id column into the array\r\n\t\t\tarrOfColumns.splice(0, 0, {label:idTitle,name:\"id\",description: \"order of lines\",type:\"number\",typeUI:\"numberbox\",enumerable:null,key:true});\r\n\t\t};\r\n\t\tvar extractUniqueFromArray = function(arr) { //http://stackoverflow.com/questions/18878571/underscore-js-find-the-most-frequently-occurring-value-in-an-array\r\n\t\t\t//returns an object {empties:no_of empties,uniqueArr:uniqueArr} where:\r\n\t\t\t//\t\tempties - number of empties ocurrences in arr\r\n\t\t\t// \t\tuniqueArr - array with all unique occurences in arr including \"\" if it exists\r\n\t\t\tarr = _.filter(arr, function(element){\r\n\t\t\t\treturn typeof element !=\"undefined\";\r\n\t\t\t});//exclude undefined elements\r\n\t\t\tvar arrWrap = _.chain(arr).countBy().pairs(); //arrGroups gives us the number of different elements\r\n\t\t\tvar arrGroups = arrWrap._wrapped; //arrGroups gives us the number of different elements\r\n\t\t\t//arrGroups has the format: [ [\"High\",40], [\"Medium\",47], [\"Premium\",5], ]\r\n\t\t\tvar emptyPair = _.find(arrGroups,function(pair){return pair[0]===\"\";});\r\n\t\t\tvar empties = 0;\r\n\t\t\tif(typeof emptyPair !== 'undefined'){//the case where there is no emptyPair =>undefined\r\n\t\t\t\tempties = emptyPair[1];\r\n\t\t\t}\r\n\t\t\tvar uniqueArr = _.map(arrGroups,function(element){return element[0];});\r\n\t\t\treturn {empties:empties,uniqueArr:uniqueArr};\r\n\t\t};\r\n\t\tvar dataRowAnalisys = function(rows, percent) {\r\n\t\t\t// this methods decides the date type of every single column in rows by analysing a sample (rows).\r\n\t\t\t// returns an array of attributes (one element per column) each element  with  format:\r\n\t\t\t//\t\t{\"fieldType\":\"string\",\"fieldTypeUI\":\"textbox\",\"numberFormat\":null, enumerable:null,label:element};\r\n\t\t\t//\r\n\t\t\t// assumes that all rows have the same json pattern with same type in the whole array - assumes type of row = type of first row\r\n\t\t\t// If column row type is \"string\" search for enumerables within that column\r\n\t\t\t//    if [(total number of groups)/(number of rows) < percent ] assumes enumerable and identifies an array of enumerables\r\n\t\t\t// returns\r\n\t\t\t//   [ {name:{fieldType:\"string\", label:\"Name\"}}, ...., {service:{fieldType:\"enumerable\", label:\"Name\", enumerable:[*]}} ]\r\n\t\t\t//      if fieldType=\"enumerable\" the property enumerable has an array with the enumerable options.\r\n\t\t\tvar numOfRows = rows.length;\r\n\t\t\tvar rowsSample = FL.common.makeFirstElementsSample(rows,50); //reduces max size of array to 50\r\n\t\t\tvar numOfSampleRows = rowsSample.length;\r\n\t\t\tvar arrOfKeys = _.keys( rows[0] );//at least row[0] must exist\r\n\t\t\tvar arrOfTypes = [];\r\n\t\t\t_.each(arrOfKeys, function(element, index){\r\n\t\t\t\tvar obj = {};\r\n\t\t\t\tvar dataType = utils.typeOf((rows[0][element]));//one of  \"number\",\"string\",\"email\",\"boolean\",\"object\",\"array\",\"null\",\"undefined\",\"date\"\r\n\t\t\t\t//note about numbers: if dataType is number no doubt about it. But...it could be a string representing a number\r\n\t\t\t\tif (dataType == \"string\") {//possible datatypes:string, integer, number, boolean, date, or json \r\n\t\t\t\t\t//analysis of the first 50 elements or all if length<50\r\n\t\t\t\t\tvar arrOfSampleRowValues = _.pluck(rowsSample,element);\r\n\t\t\t\t\t//the base javascript is of type \"string\" but it can be:\r\n\t\t\t\t\t//    a date in string format\r\n\t\t\t\t\t//    an enumerable\r\n\t\t\t\t\tvar numberObj=FL.common.getArrNumberFormat(arrOfSampleRowValues);\r\n\t\t\t\t\tif (numberObj.number){//this string is a number in string format\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"number\",\"fieldTypeUI\":\"numberbox\",\"numberFormat\":numberObj.format, enumerable:null, label:element};\r\n\t\t\t\t\t\t//now the whole column must be converted from string to numeric\r\n\t\t\t\t\t\t// var arrOfColumnToConvert = _.pluck(rows,element);\r\n\t\t\t\t\t\t// FL.common.convertStringVectorToNumber(arrOfColumnToConvert,numberObj.format);\r\n\t\t\t\t\t}else if( FL.common.is_dateArrInStringFormat(arrOfSampleRowValues) ){//values are in string format but are they a deguised date column ?\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"date\",\"fieldTypeUI\":\"datetextbox\",\"numberFormat\":null, enumerable:null, label:element};\r\n\t\t\t\t\t}else if( FL.common.is_enumerableArr(arrOfSampleRowValues,percent) ){//It is an enumerable we will prepare the enumerable content\r\n\t\t\t\t\t\tvar arrOfAllRowValues = _.pluck(rows,element);\r\n\t\t\t\t\t\tvar fullUniqueObj = FL.common.extractUniqueFromArray(arrOfAllRowValues);\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"string\",\"fieldTypeUI\":\"combobox\",\"numberFormat\":null, enumerable:fullUniqueObj.uniqueArr, label:element};\r\n\t\t\t\t\t}else{//not a string number, note a string date and  not an enumerable\r\n\t\t\t\t\t\tvar uniqueObj = FL.common.extractUniqueFromArray(arrOfSampleRowValues);\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"string\",\"fieldTypeUI\":\"textbox\",\"numberFormat\":null, enumerable:null,label:element};\r\n\t\t\t\t\t\tif( is_ColumnOfSubtype( \"email\",uniqueObj.uniqueArr ) ) //checks that all sample objects are of subtype\r\n\t\t\t\t\t\t\tobj[element][\"fieldTypeUI\"] = \"email\";\r\n\t\t\t\t\t\telse if( is_ColumnOfSubtype( \"url\",uniqueObj.uniqueArr ) )\r\n\t\t\t\t\t\t\tobj[element][\"fieldTypeUI\"] = \"url\";\r\n\t\t\t\t\t\telse if( is_ColumnOfSubtype( \"phone\",uniqueObj.uniqueArr ) )\r\n\t\t\t\t\t\t\tobj[element][\"fieldTypeUI\"] = \"phone\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif (dataType == \"number\") {//possible datatypes:string, integer, number, boolean, date, or json \r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"number\",\"fieldTypeUI\":\"numberbox\",\"numberFormat\":null, enumerable:null, label:element};\r\n\t\t\t\t\t}else if(dataType == \"email\") {\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"string\",\"fieldTypeUI\":\"emailbox\",\"numberFormat\":null, enumerable:null, label:element};\r\n\t\t\t\t\t}else if(dataType == \"boolean\") {\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"boolean\",\"fieldTypeUI\":\"checkbox\",\"numberFormat\":null, enumerable:null, label:element};\r\n\t\t\t\t\t}else if(dataType == \"date\") {\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"date\",\"fieldTypeUI\":\"datetextbox\",\"numberFormat\":null, enumerable:null, label:element};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tobj[element] = {\"fieldType\":\"string\",\"fieldTypeUI\":\"textbox\",\"numberFormat\":null, enumerable:null,label:element};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tarrOfTypes.push(obj);\r\n\t\t\t});\r\n\t\t\treturn arrOfTypes;\r\n\t\t};\r\n\t\tvar translateToDDFormat = function(arrOfAttributes){//translates arrOfAttributes format to dd format\r\n\t\t\t// format of array [attributeName1:{fieldType\":\"string\",\"fieldTypeUI\":\"textbox\",\"numberFormat\":null, enumerable:null,label:element},attributeName2:{..}]\r\n\t\t\t// returns  - array of objects in dd format [{name:\"address\",description:\"address to send invoices\",label:\"Address\",type:\"string\",typeUI:\"textbox\",enumerable:null,key:false},{}..];\r\n\t\t\tvar attributesArr = [];\r\n\t\t\tvar attrName = null;\r\n\t\t\t_.each(arrOfAttributes, function(element,index){\r\n\t\t\t\tattrName = _.keys(element)[0];\r\n\t\t\t\tattributesArr.push({\"name\": attrName,description: \"description of \" + attrName,label: element[attrName].label,type: element[attrName].fieldType, typeUI: element[attrName].fieldTypeUI, enumerable: element[attrName].enumerable, key: false});\r\n\t\t\t});\r\n\t\t\treturn attributesArr;\r\n\t\t};\r\n\t\t// var createAttributesArrFromCsvAnalisys = function(rows){//creates the equivalent to a dd entry from a set of rows\r\n\t\tvar adjustRowsToAttributes = function(rows,arrOfAttributes){//creates the equivalent to a dd entry from a set of rows\r\n\t\t\t// rows - an array of objects format [{\"colum1Name\":col11,\"colum2Name\":col12,..},{\"colum1Name\":col21,\"colum2Name\":col22,..}...{}]\r\n\t\t\t// arrOfAttributes has analysis format ->[attributeName1:{fieldType\":\"string\",\"fieldTypeUI\":\"textbox\",\"numberFormat\":null, enumerable:null,label:element},attributeName2{..}]\r\n\t\t\t//arrOfAttributes - array of objects ex: [{name:\"address\",description:\"address to send invoices\",label:\"Address\",type:\"string\",typeUI:\"textbox\",enumerable:null,key:false},{}..];\r\n\t\t\t// returns an array with the same format as dd dictionary array of attributes. Each element has the following format:\r\n\t\t\t//      ex: {name:\"address\",description:\"address to send invoices\",label:\"Address\",type:\"string\",enumerable:null,key:false});\r\n\t\t\t// var attributesArr = [];\r\n\t\t// var arrOfAttributes = dataRowAnalisys(rows, 0.5);//returns an array of attributes (one element per column) \r\n\t\t\tvar rrows = rows;\r\n\t\t\t//\tformat of arrOfAttributes {\"fieldType\":\"string\",\"fieldTypeUI\":\"textbox\",\"numberFormat\":null, enumerable:null,label:element};\r\n\t\t\t_.each(arrOfAttributes, function(element,index){\r\n\t\t\t\tvar attrName = _.keys(element)[0];\r\n\t\t\t\tvar fieldType =element[attrName].fieldType;\r\n\t\t\t\tvar fieldTypeUI =element[attrName].fieldTypeUI;\r\n\t\t\t\tvar numberFormat =element[attrName].numberFormat;\r\n\t\t\t\tvar label =element[attrName].label;\r\n\t\t\t\tvar enumerable = null;\r\n\t\t\t\tvar columnVector = null;\r\n\t\t\t\tvar rows = rrows;\r\n\t\t\t\t// if(fieldType==\"enumerable\"){\r\n\t\t\t\t//     enumerable = element[attrName].enumerable;\r\n\t\t\t\t// }\r\n\t\t\t\tif(fieldType==\"string\" && fieldTypeUI == \"combobox\"){\r\n\t\t\t\t\tenumerable = element[attrName].enumerable;\r\n\t\t\t\t}else if(fieldType==\"number\"){\r\n\t\t\t\t\t// columnVector = _.pluck(rows,attrName);\r\n\t\t\t\t\tvar numberVal = null;\r\n\t\t\t\t\t// FL.common.convertStringVectorToNumber(columnVector,numberFormat);\r\n\t\t\t\t\t_.each(rows, function(rowElement,index){\r\n\t\t\t\t\t\tnumberVal = rowElement[attrName];\r\n\t\t\t\t\t\trowElement[attrName] =  FL.common.localeStringToNumber(numberVal,numberFormat);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tFL.common.printToConsole(\"createAttributesArrFromCsvAnalisys NUMERIC attrName=\"+attrName + \" is complete........\");\r\n\t\t\t\t\tvar z= 32;\r\n\t\t\t\t}else if(fieldType==\"date\"){\r\n\t\t\t\t\t//we will see\r\n\t\t\t\t\t// columnVector = _.pluck(rows,attrName);\r\n\t\t\t\t\t_.each(rows, function(rowElement,index){\r\n\t\t\t\t\t\tif(typeof rowElement[attrName] != \"date\" ){//if is a string containing a date must be converted\r\n\t\t\t\t\t\t\trowElement[attrName] = new Date( rowElement[attrName] );//old content in string is converted to date\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tFL.common.printToConsole(\"createAttributesArrFromCsvAnalisys DATE attrName=\"+attrName + \" is complete........\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar is_ColumnOfSubtype = function(subtype,sampleArr){//scans all elements of sampleArr and returns true if all non empty elements belongs to subtype\r\n\t\t\t//example \r\n\t\t\t//\t\tif( is_ColumnOfSubtype(\"email\",arrOfRowValues) )\r\n\t\t\t//\t\tif( is_ColumnOfSubtype(\"url\",arrOfRowValues) )\r\n\t\t\t//\t\tif( is_ColumnOfSubtype(\"phone\",arrOfRowValues) )\r\n\t\t\t//  the subtype must be one of the existing subtypes in FL.utils.typeUIOf() \t\t\t\t\r\n\t\t\tvar is=false;\r\n\t\t\tvar len = sampleArr.length;\r\n\t\t\tfor(var i=0;i<len;i++){\r\n\t\t\t\tif (sampleArr[i].trim().length > 0 ){\r\n\t\t\t\t\tif( utils.typeUIOf(sampleArr[i]) == subtype ){\r\n\t\t\t\t\t\tis = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tis = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn is;\r\n\t\t};\r\n\t\tvar editGrid = function(entityName){\r\n\t\t\t// FL.common.makeModalInfo(\"Edit \" + entityName + \" x To be implemented soon\");\r\n\t\t\t$(\"#_editGrid\").empty();\r\n\t\t\t$(\"#_modalDialogB\").empty();\r\n\r\n\t\t\tvar singular  = entityName;\r\n\t\t\tvar description = FL.dd.getEntityBySingular(entityName).description;\r\n\t\t\tvar attributesArrNoId = csvStore.getAttributesArrNoId();//we retrieve all except name=\"id\"\r\n\t\t\tvar detailItems = utils.buildMasterDetailStructureFromAttributesArr(attributesArrNoId);\r\n\t\t\tvar masterDetailItems = {\r\n\t\t\t\tmaster:{entityName:singular,entityDescription:description},\r\n\t\t\t\tdetailHeader:[\"#\",\"Attribute\",\"what is it\",\"Statement to validate\"],\r\n\t\t\t\tdetail:detailItems //format is array with {attribute:<attribute name>,description:<attr description>,statement:<phrase>,type:<type>}\r\n\t\t\t};\r\n\t\t\tvar arrOfObj = FL.dd.arrOfUserTypesForDropdown();\r\n\t\t\tvar options = {\r\n\t\t\t\ttype:\"primary\",\r\n\t\t\t\ticon:\"pencil\",\r\n\t\t\t\tbutton1:\"Cancel\",\r\n\t\t\t\tbutton2:\"Confirm Table Dictionary\",\r\n\t\t\t\tdetailDropdown:{\r\n\t\t\t\t\t\"userType\":{\r\n\t\t\t\t\t\tarr:arrOfObj,//array of types\r\n\t\t\t\t\t\tonSelect:function(objSelected,line){\r\n\t\t\t\t\t\t\tvar selectedType = objSelected.text;\r\n\t\t\t\t\t\t\t//we need to get the current attribute name from the DOM because it could have been changed\r\n\t\t\t\t\t\t\tvar oldAttribute = masterDetailItems.detail[line].attribute;\r\n\t\t\t\t\t\t\tvar currentAttribute = $(\"#_dictEditEntityTemplate__f\"+(line+1)+\"_attribute\").val();//\"_dictEditEntityTemplate__f4_userType_options\"\r\n\t\t\t\t\t\t\t// var title = \" Define possible values for \"+masterDetailItems.detail[line].attribute;\r\n\t\t\t\t\t\t\tvar title = \" Define possible values for \"+currentAttribute;\r\n\t\t\t\t\t\t\tvar enumArr = csvStore.getEnumerableFromAttribute(oldAttribute);\r\n\t\t\t\t\t\t\tvar enumStr = \"\";\r\n\t\t\t\t\t\t\tif(enumArr)\r\n\t\t\t\t\t\t\t\tenumStr = enumArr.join(\",\");\r\n\t\t\t\t\t\t\tif(selectedType == \"combo list\"){\r\n\t\t\t\t\t\t\t\tvar masterDetailListItems = { master:{list:enumStr} };\r\n\t\t\t\t\t\t\t\tvar enumOptions = {type:\"primary\", icon:\"th-list\", button1:\"Cancel\", button2:\"Confirm select list\"};\r\n\t\t\t\t\t\t\t\tFL.common.editMasterDetail(\"A2\",title,\"_getComboList\",masterDetailListItems,enumOptions,function(result){\r\n\t\t\t\t\t\t\t\t\tif(result){\r\n\t\t\t\t\t\t\t\t\t\t// alert(\"The list is ->\"+masterDetailListItems.master.list);\r\n\t\t\t\t\t\t\t\t\t\tvar listOfValuesStr = masterDetailListItems.master.list;\r\n\t\t\t\t\t\t\t\t\t\tcsvStore.setEnumerableForAttribute(oldAttribute,listOfValuesStr.split(\",\"));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif(selectedType == \"lookup\"){\r\n\t\t\t\t\t\t\t\tFL.dd.init_t();//to init the temporary subsystem\r\n\t\t\t\t\t\t\t\tFL.dd.t.entities.dumpToConsole();\r\n\t\t\t\t\t\t\t\tvar currentECN = FL.dd.getCEntity(entityName);\r\n\t\t\t\t\t\t\t\tvar currentFCN = FL.dd.t.entities[currentECN].getCName(currentAttribute);\r\n\t\t\t\t\t\t\t\tvar lookupObj = FL.dd.t.entities[currentECN].fields[currentFCN].specialTypeDef;\r\n\t\t\t\t\t\t\t\tvar lookupTypeStr = \"Invalid format\";\r\n\t\t\t\t\t\t\t\tif(FL.common.typeOf(lookupObj) == \"object\"){\r\n\t\t\t\t\t\t\t\t\tlookupTypeStr = lookupObj.eCN + \".\" + lookupObj.fCN //loojupObj format is {eCN:<entity compressed name>, fCN:<field compressed name>}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tvar masterDetailListItems = { master:{special:lookupTypeStr} };\r\n\t\t\t\t\t\t\t\tvar enumOptions = {type:\"primary\", icon:\"th-list\", button1:\"Cancel\", button2:\"Confirm lookup data\"};\r\n\t\t\t\t\t\t\t\tFL.common.editMasterDetail(\"A2\",title,\"_getLookupTableAndField\",masterDetailListItems,enumOptions,function(result){\r\n\t\t\t\t\t\t\t\t\tif(result){\r\n\t\t\t\t\t\t\t\t\t\t// alert(\"The list is ->\"+masterDetailListItems.master.list);\r\n\t\t\t\t\t\t\t\t\t\tvar specialTypeDef = masterDetailListItems.master.special;\r\n\t\t\t\t\t\t\t\t\t\t//save into the data dictionary\r\n\t\t\t\t\t\t\t\t\t\tvar specialDefArr= specialTypeDef.split(\",\");\r\n\t\t\t\t\t\t\t\t\t\tvar specialObj={eCN:specialDefArr[0], fCN:specialDefArr[1]};\r\n\t\t\t\t\t\t\t\t\t\tFL.dd.t.entities[currentECN].fields[currentFCN].setField({specialTypeDef:specialObj});\r\n\t\t\t\t\t\t\t\t\t\tvar z = 32;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// alert(\"The selection was \"+selectedType);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tFL.common.editMasterDetail(\"B\",\" Define Table Dictionary\",\"_dictEditEntityTemplate\",masterDetailItems,options,function(result){\r\n\t\t\t\tif(result){\r\n\t\t\t\t\t//We update name and description in csvStore.attributesArr and then use it to create dictionary fields. \r\n\t\t\t\t\tvar attributesArrNoId = csvStore.getAttributesArrNoId();//we retrieve all except name=\"id\"\r\n\t\t\t\t\t//   ex: {name:\"address\",description:\"address to send invoices\",label:\"Address\",type:\"string\",typeUI:\"textbox\",enumerable:null,key:false});\t\t                \r\n\t\t\t\t\tvar changedAttributesArr = [];\r\n\t\t\t\t\tvar changedTypeArr = [];\r\n\t\t\t\t\tvar newAttributesArr = [{name:\"id\",description:\"order of lines\",label:\"id\",type:\"number\",typeUI:\"numberbox\",enumerable:null,key:true}];\r\n\t\t\t\t\t_.each(attributesArrNoId, function(element,index){//to retrieve the lines content from the interface\r\n\t\t\t\t\t\tvar elObj = {};\r\n\t\t\t\t\t\telObj[\"oldName\"] = attributesArrNoId[index].name;\r\n\t\t\t\t\t\telObj[\"name\"] = masterDetailItems.detail[index].attribute.trim();\r\n\t\t\t\t\t\tif(elObj[\"name\"] != attributesArrNoId[index].name)\r\n\t\t\t\t\t\t\tchangedAttributesArr.push( [ attributesArrNoId[index].name, elObj[\"name\"] ] );//oldName,newName\r\n\t\t\t\t\t\telObj[\"description\"] = masterDetailItems.detail[index].description.trim();\r\n\t\t\t\t\t\telObj[\"label\"] = masterDetailItems.detail[index].attribute.trim();\r\n\t\t\t\t\t\tvar userType = masterDetailItems.detail[index].userType.trim();//the item collected in the form combo\r\n\t\t\t\t\t\tvar userTypeObj = FL.dd.userTypes[userType];//returns type and typeUI corresponding to that userType\r\n\t\t\t\t\t\telObj[\"type\"] = userTypeObj.type;\r\n\t\t\t\t\t\tif(elObj[\"type\"] != attributesArrNoId[index].type)\r\n\t\t\t\t\t\t\tchangedTypeArr.push( [ attributesArrNoId[index].name, attributesArrNoId[index].type, elObj[\"type\"] ] );//oldName,oldType,newType\r\n\t\t\t\t\t\telObj[\"typeUI\"] = userTypeObj.typeUI;\r\n\t\t\t\t\t\telObj[\"enumerable\"] = csvStore.getEnumerableFromAttribute(attributesArrNoId[index].name);\r\n\t\t\t\t\t\telObj[\"key\"] = false;\r\n\t\t\t\t\t\tnewAttributesArr.push(elObj);\r\n\t\t\t\t\t},this);\r\n\t\t\t\t\tvar singular = masterDetailItems.master.entityName.trim();//to retrieve the header content from the interface\r\n\t\t\t\t\tvar description = masterDetailItems.master.entityDescription.trim();//to retrieve the header content from the interface\r\n\t\t\t\t\tif( csvStore.is_dictionaryUpdateLoseInformation( changedTypeArr) ){\r\n\t\t\t\t\t\tFL.common.makeModalConfirm(\"You will lose some information. Do you want to continue ?\",\"No, cancel changes\",\"Yes Please\",function(result){\r\n\t\t\t\t\t\t\tif(result){\r\n\t\t\t\t\t\t\t\tupdateDictionaryAndTypesInServer(entityName,singular,description,newAttributesArr,changedAttributesArr,changedTypeArr);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tFL.common.makeModalInfo(\"Nothing was saved. The original grid is going to be restored....\");\r\n\t\t\t\t\t\t\t\tFL.grid.displayDefaultGrid(entityName);//loads from server and display\r\n\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tupdateDictionaryAndTypesInServer(entityName,singular,description,newAttributesArr,changedAttributesArr,changedTypeArr);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tFL.common.makeModalInfo(\"Nothing was saved.\");\r\n\t\t\t\t}\r\n\t\t\t});//OK\r\n\t\t};\r\n\t\tvar updateDictionaryAndTypesInServer = function(entityName,newSingularName,description,newAttributesArr,changedAttributesArr,changedTypeArr){\r\n\t\t\t//Update Dictionary and Entity data in server - silently uses csvStore.csvRows and local dictionary\r\n\t\t\t//updateTypesInServer must synchronize: local dictionary, server dictionary, csvStore and entity on server\r\n\t\t\t// if data dictionary update fails on server it rools back the local dictionary change\r\n\t\t\t//    tests:force dictionary fail\r\n\t\t\t// if data dictionary update succeds but entity update on server fails \r\n\t\t\tvar storedArr= csvStore.extractFromCsvStore();\r\n\t\t\tif( FL.API.nicoTestDuplicateIds(storedArr) ){//only works if no duplicate _id exist in csvStore\r\n\t\t\t\talert(\"FLGrid2 updateDictionaryAndTypesInServer - csvStore.csvRows _id duplicate DETECTED !!!. Nothing was done\");\r\n\t\t\t\treturn;\t\r\n\t\t\t}\r\n\t\t\t// var z = msg.abc; //to force error\r\n\t\t\tvar localDictEntityBackup = FL.dd.getDictEntityBackup(entityName);\r\n\t\t\tvar spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\t\tvar updateDictionaryAllAttributesPromise = FL.API.updateDictionaryAllAttributes(entityName,newSingularName,description,newAttributesArr);\r\n\t\t\tupdateDictionaryAllAttributesPromise.done(function(){//this update local and server dictionary\r\n\t\t\t\tif(changedTypeArr.length>0){//there is type change(s)\r\n\t\t\t\t\tcsvStore.transformStoreTo(newAttributesArr,changedAttributesArr,changedTypeArr);//does changes in csvStore\r\n\t\t\t\t\tvar updatePromise = FL.grid.updateCurrentCSVToServer(newSingularName);\r\n\t\t\t\t\tupdatePromise.done(function(){\r\n\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\tFL.grid.displayDefaultGrid(newSingularName);//loads from server and display\r\n\t\t\t\t\t});\r\n\t\t\t\t\tupdatePromise.fail(function(err){\r\n\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\tFL.dd.entities[newSingularName] = localDictEntityBackup;//rools back local dictionary update\r\n\t\t\t\t\t\tFL.dd.setSync(entityName,false); //warns that local dict is not in sync with server dictionary\r\n\t\t\t\t\t\talert(\"FLGrid2 updateDictionaryAndTypesInServer updateCurrentCSVToServer Failure err=\"+err);//loads from server and displaywithout newsl\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\tFL.grid.displayDefaultGrid(newSingularName);//loads from server and display\r\n\t\t\t\t}\t\r\n\t\t\t});\r\n\t\t\tupdateDictionaryAllAttributesPromise.fail(function(err){\r\n\t\t\t\tspinner.stop();\r\n\t\t\t\tFL.dd.entities[newSingularName] = localDictEntityBackup;//rools back local dictionary update - TESTED OK\r\n\t\t\t\talert(\"FLGrid2 updateDictionaryAndTypesInServer updateDictionaryAllAttributes Failure err=\"+err);//loads from server and displaywithout newsl\r\n\t\t\t});\r\n\t\t};\t\t\r\n\t\tvar addImageToMandrillImageArr = function(name,srcContent){//mandrillImagesArr is formed to FL.login.emailImagesArray\r\n\t\t\t// var srcContent = imageFromJson.substring(23);//removes the beginning chars:\"data:image/jpeg;base64,\"\r\n\t\t\tvar imageArrElement = {name:name, type:\"image/jpg\", content:srcContent};\r\n\t\t\tFL.login.emailImagesArray.push(imageArrElement);\r\n\t\t};\r\n\t\tvar elementTemplateHTML = function(type,thiz){\r\n\t\t\tvar elementId = type + \"DroppedItem\";\r\n\t\t\tvar rawElementTemplate = $(\"#\"+elementId).html();\r\n\t\t\tvar templateFunc =  _.template(rawElementTemplate);\r\n\t\t\tvar elementTemplate = templateFunc({\r\n\t\t\t\tbgColor:thiz.bgColor,\r\n\t\t\t\tpaddingLeft:thiz.marginL,\r\n\t\t\t\tcentralWidth:thiz.centralWidth,\r\n\t\t\t\tpaddingRight:thiz.marginR,\r\n\t\t\t\telNo:''//window.templateCounter FOR TESTING\r\n\t\t\t});\r\n\t\t\treturn elementTemplate;\r\n\t\t};\r\n\t\tvar buildSocialDivHTML = function(item){\r\n//<a href=\"https://www.facebook.com/Weadvice.living.web\"><img id=\"facebook\" title=\"Facebook\" src=\"http://framelink.co/app/images/social/Facebook.png\" alt=\"Facebook\" width=\"48\" height=\"48\"></a>\r\n\t\t\tvar socialTemplate = '<a href=\"<%= url %>\"><img id=\"<%= socialId %>\" title=\"<%= socialTitle %>\" src=\"<%= src %>\" alt=\"<%= socialTitle %>\" width=\"48\" height=\"48\"></a>';\r\n\t\t\tvar socialEl = $(\"<div></div>\");\r\n\t\t\tvar templateFunc =  _.template(socialTemplate);\r\n\t\t\tvar strHTML = \"\";\r\n\t\t\tif(item.linksData.facebook.enable){\r\n\t\t\t\tstrHTML = templateFunc({\r\n\t\t\t\t\turl:item.linksData.facebook.url,\r\n\t\t\t\t\tsocialId:\"facebook\",\r\n\t\t\t\t\tsocialTitle:item.linksData.facebook.text,\r\n\t\t\t\t\tsrc:\"http://framelink.co/app/images/social/Facebook.png\",\r\n\t\t\t\t});\r\n\t\t\t\tsocialEl.append(strHTML);\r\n\t\t\t}\r\n\t\t\tif(item.linksData.linkedIn.enable){\r\n\t\t\t\tstrHTML = templateFunc({\r\n\t\t\t\t\turl:item.linksData.linkedIn.url,\r\n\t\t\t\t\tsocialId:\"linkedIn\",\r\n\t\t\t\t\tsocialTitle:item.linksData.linkedIn.text,\r\n\t\t\t\t\tsrc:\"http://framelink.co/app/images/social/Linkedin.png\",\r\n\t\t\t\t});\r\n\t\t\t\tsocialEl.append(strHTML);\r\n\t\t\t}\r\n\t\t\tif(item.linksData.googlePlus.enable){\r\n\t\t\t\tstrHTML = templateFunc({\r\n\t\t\t\t\turl:item.linksData.googlePlus.url,\r\n\t\t\t\t\tsocialId:\"googlePlus\",\r\n\t\t\t\t\tsocialTitle:item.linksData.googlePlus.text,\r\n\t\t\t\t\tsrc:\"http://framelink.co/app/images/social/Google-Plus.png\",\r\n\t\t\t\t});\r\n\t\t\t\tsocialEl.append(strHTML);\t\t\r\n\t\t\t}\r\n\t\t\tif(item.linksData.youTube.enable){ \r\n\t\t\t\tstrHTML = templateFunc({\r\n\t\t\t\t\turl:item.linksData.youTube.url,\r\n\t\t\t\t\tsocialId:\"youTube\",\r\n\t\t\t\t\tsocialTitle:item.linksData.youTube.text,\r\n\t\t\t\t\tsrc:\"http://framelink.co/app/images/social/Youtube.png\",\r\n\t\t\t\t});\r\n\t\t\t\tsocialEl.append(strHTML);\t\t\t\t\r\n\t\t\t}\r\n\t\t\t// if(item.linksData.twitter.enable){\r\n\t\t\t// \tstrHTML = templateFunc({\r\n\t\t\t// \t\turl:item.linksData.twitter.url,\r\n\t\t\t// \t\tsocialId:\"twitter\",\r\n\t\t\t// \t\tsocialTitle:item.linksData.twitter.text,\r\n\t\t\t// \t\tsrc:\"http://framelink.co/app/images/social/Twitter.png\",\r\n\t\t\t// \t});\r\n\t\t\t// \tsocialEl.append(strHTML);\t\t\t\t\t\r\n\t\t\t// }\r\n\t\t\tif(item.linksData.mail.enable){\r\n\t\t\t\tstrHTML = templateFunc({\r\n\t\t\t\t\turl:item.linksData.mail.url,\r\n\t\t\t\t\tsocialId:\"mail\",\r\n\t\t\t\t\tsocialTitle:item.linksData.mail.text,\r\n\t\t\t\t\tsrc:\"http://framelink.co/app/images/social/Email.png\",\r\n\t\t\t\t});\r\n\t\t\t\tsocialEl.append(strHTML);\t\t\r\n\t\t\t}\r\n\t\t\treturn socialEl;\r\n\t\t};\t\t\r\n\t\tvar appendTemplate = function(jsonObject, parentElement,centralWidth,percent,marginL,marginR,bgColor){\r\n\t\t\t// jsonObject - array jsons corresponding to a parentElement (ex.header, body or footer) \r\n\t\t\t// ex:[{\"title\":\"<p>Mastruncio1</p>\",\"style\":{\"fontColor\":\"#000\",\"fontFamily\":\"Arial\",....\"imagePadding\":\"10px\"},\"type\":\"title\"}]\r\n\t\t\tthis.centralWidth = centralWidth;\r\n\t\t\tthis.marginL = marginL;\r\n\t\t\tthis.marginR = marginR;\r\n\t\t\tthis.bgColor = bgColor;\r\n\t\t\tvar thiz = this;\r\n\t\t\tvar centralWidth = centralWidth;\r\n\t\t\t$.each(jsonObject,function(i,item){//item is array element i\r\n\t\t\t\t// var element = temp.getElementToDrop(item.type);\r\n\t\t\t\tvar element = null;\r\n\t\t\t\tvar elementId = item.type + \"DroppedItem\";\r\n\t\t\t\tif( item.type == \"SocialLinks\" ) {\r\n\t\t\t\t\tvar rawElementTemplate = elementTemplateHTML(item.type,thiz);\r\n\t\t\t\t\tvar element = $(rawElementTemplate);\r\n\t\t\t\t\tvar insideDiv = element.find(\"div\");//returns the only div in element\r\n\t\t\t\t\tvar elementSocial = buildSocialDivHTML(item);\r\n\t\t\t\t\tinsideDiv.empty();\r\n\t\t\t\t\tinsideDiv.append(elementSocial.html());//only the innercontent of elementSocial is appended...\r\n\t\t\t\t\t$(parentElement).append(element);\t\t\t\t\t\r\n\t\t\t\t}else if( item.type == \"title\" ) {\r\n\t\t\t\t\tvar rawElementTemplate = elementTemplateHTML(item.type,thiz);\r\n\t\t\t\t\tvar element = $(rawElementTemplate);\r\n\t\t\t\t\tvar insideDiv = element.find(\"div\");//returns the only div in element\r\n\t\t\t\t\tinsideDiv.prop('id',\"template\"+ window.templateCounter);\r\n\t\t\t\t\tinsideDiv.css(item.style);\r\n\t\t\t\t\tinsideDiv.html(item.title);//PRODUCTION \r\n\t\t\t\t\t// insideDiv.html(\"<p>text of \"+window.templateCounter+\"</p>\");//TO TEST PURPOSES\r\n\t\t\t\t\t$(parentElement).append(element);\r\n\t\t\t\t}else if(item.type == \"image\"){\r\n\t\t\t\t\tvar rawElementTemplate = elementTemplateHTML(item.type,thiz);\r\n\t\t\t\t\tvar element = $(rawElementTemplate);\r\n\t\t\t\t\tvar insideDiv = element.find(\"div\").first();//returns the first div in element\r\n\t\t\t\t\tinsideDiv.prop('id',\"imageTemplate\"+ window.templateCounter);\r\n\r\n\t\t\t\t\t// var elementImg = $('#'+\"template\"+ window.templateCounter+ ' img');//Id already assigned we search the sub element image\r\n\t\t\t\t\tvar elementImg = insideDiv.find('img');//Id already assigned we search the sub element image\r\n\t\t\t\t\t// var elementAnchor = $('#'+\"template\"+ window.templateCounter+ ' a');//Id already assigned we search the sub element anchor\r\n\t\t\t\t\tvar elementAnchor = insideDiv.find('a');//Id already assigned we search the sub element anchor\r\n\t\t\t\t\tif (item.link)\r\n\t\t\t\t\t\t$(elementAnchor).attr('href',item.link);\r\n\r\n\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t//------TEST CODE\r\n\t\t\t\t\t//http://jsfiddle.net/joaool/MCSyr/230/\r\n\t\t\t\t\tvar style ={};\r\n\t\t\t\t\tif(window.templateCounter==0){\r\n\t\t\t\t\t\t$(elementImg).attr('src','http://placehold.it/140x100');//<img src='http://placehold.it/200x200'/>\r\n\t\t\t\t\t\t$(elementImg).attr(\"align\",\"right\");\r\n\t\t\t\t\t}else if(window.templateCounter<4){\r\n\t\t\t\t\t\t$(elementImg).attr('src','http://dummyimage.com/200x100&text=200 by 100');//<img src='http://placehold.it/200x200'/>\r\n\t\t\t\t\t}else if(window.templateCounter<6){\r\n\t\t\t\t\t\t$(elementImg).attr('src','http://dummyimage.com/400x100&text=400 with max380');//<img src='http://placehold.it/200x200'/>\r\n\t\t\t\t\t\t$(elementImg).attr(\"width\",\"380\");\r\n\t\t\t\t\t\t$(elementImg).attr(\"height\",\"auto\");\r\n\t\t\t\t\t}else if(window.templateCounter<8){\r\n\t\t\t\t\t\t$(elementImg).attr('src','http://dummyimage.com/500x100&text=500 with max380');//<img src='http://placehold.it/200x200'/>\r\n\t\t\t\t\t\t$(elementImg).attr(\"width\",\"380\");\r\n\t\t\t\t\t\t$(elementImg).attr(\"height\",\"auto\");\r\n\t\t\t\t\t}else if(window.templateCounter<10){\r\n\t\t\t\t\t\t$(elementImg).attr('src','http://dummyimage.com/500x100&text=500 with max468');//<img src='http://placehold.it/200x200'/>\r\n\t\t\t\t\t\t$(elementImg).attr(\"width\",\"468\");\r\n\t\t\t\t\t\t$(elementImg).attr(\"height\",\"auto\");\r\n\t\t\t\t\t\t$(elementImg).attr(\"align\",\"right\");\r\n\t\t\t\t\t\t// $(elementImg).css(style);\r\n\t\t\t\t\t}else if(window.templateCounter<12){\r\n\t\t\t\t\t\t$(elementImg).attr('src','http://dummyimage.com/700x100&text=700 with max468');//<img src='http://placehold.it/200x200'/>\r\n\t\t\t\t\t\t$(elementImg).attr(\"width\",\"468\");\r\n\t\t\t\t\t\t$(elementImg).attr(\"height\",\"auto\");\r\n\t\t\t\t\t\t// $(elementImg).attr(\"border\", \"1px solid #ff0000;\");\r\n\t\t\t\t\t\t$(elementImg).attr(\"align\",\"right\");\r\n\t\t\t\t\t\t$(elementImg).css(style);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$(elementImg).attr('src','http://placehold.it/350x150');//<img src='http://placehold.it/200x200'/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(parentElement).append(element);\r\n\t\t\t\t\t//------END OF TEST CODE\r\n\t\t\t\t\t*/\r\n\t\t\t\t\t//------- PRODUCTION CODE\r\n\t\t\t\t\taddImageToMandrillImageArr(\"template\"+ window.templateCounter,item.source.substring(23));//name,imageFromJson - removes the beginning chars:\"data:image/jpeg;base64,\"\r\n\t\t\t\t\t$(elementImg).attr('src','cid:template'+ window.templateCounter);\r\n\t\t\t\t\tvar style ={};\r\n\t\t\t\t\tvar w = FL.common.getBase64Width(item.source);//check if size is bigger than central zone to prevebt broken layout\r\n\t\t\t\t\tif (w> thiz.centralWidth){//reduce size keeping ratio: (convenient for outlook)  width=\"400px\" height=\"auto\"\r\n\t\t\t\t\t\t// item.style[\"width\"]= thiz.centralWidth + \"px\";\r\n\t\t\t\t\t\t$(elementImg).attr(\"width\", thiz.centralWidth);\r\n\t\t\t\t\t\t$(elementImg).attr(\"height\",\"auto\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$(elementImg).attr(\"width\", w);\r\n\t\t\t\t\t\t$(elementImg).attr(\"height\",\"auto\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(parentElement).append(element);\r\n\t\t\t\t\t//------ END OF PRODUCTION CODE\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\twindow.templateCounter++;\r\n\t\t\t});\r\n\t\t};\t\t\r\n\t\tvar getHTMLContent = function(jsonTemplate){\r\n\t\t\t// alert(jsonTemplate);\r\n\t\t\tvar jsonObj = JSON.parse(jsonTemplate);\r\n\t\t\t// we assume a total with of 1300 - the percentage will act upon 1300 =>max=90%*1300 = 1170\r\n\t\t\tvar percent = Math.floor( Math.min(jsonObj.pageStyles.pageWidth,900)/10 );\r\n\t\t\t// var marginL = jsonObj.pageStyles.headerPaddingLeft*percent/100;\r\n\t\t\t// var marginR = jsonObj.pageStyles.headerPaddingRight*percent/100;\r\n\t\t\tvar marginL =  Math.floor(1300*(jsonObj.pageStyles.headerPaddingLeft/jsonObj.pageStyles.pageWidth)*percent/100);\r\n\t\t\tvar marginR =  Math.floor(1300*(jsonObj.pageStyles.headerPaddingRight/jsonObj.pageStyles.pageWidth)*percent/100);\r\n\r\n\t\t\t// var centralWidthHeader = percent*1300/100 - marginL - marginR;\r\n\t\t\tvar centralWidthHeader =1300*((jsonObj.pageStyles.pageWidth-jsonObj.pageStyles.headerPaddingLeft-jsonObj.pageStyles.headerPaddingRight)/jsonObj.pageStyles.pageWidth)*percent/100;\r\n\t\t\tvar rawEmailTemplate = $(\"#emailTemplateHolder\").html();\r\n\t\t\tvar templateFunc =  _.template(rawEmailTemplate);\r\n\t\t\tvar emailTemplate = templateFunc({\r\n\t\t\t\tglobalPercent:percent,\r\n\t\t\t\theaderBgcolor:jsonObj.pageStyles.headerBgColor,\r\n\t\t\t\theaderPaddingLeft:marginL,//jsonObj.pageStyles.headerPaddingLeft,\r\n\t\t\t\theaderPaddingRight:marginR,//jsonObj.pageStyles.headerPaddingRight,\r\n\t\t\t\tbodyBgcolor:jsonObj.pageStyles.bodyBgColor,\r\n\t\t\t\tbodyPaddingLeft:marginL,//jsonObj.pageStyles.bodyPaddingLeft,\r\n\t\t\t\tbodyPaddingRight:marginR,//jsonObj.pageStyles.bodyPaddingRight,\r\n\t\t\t\tfooterBgcolor:jsonObj.pageStyles.footerBgColor,\r\n\t\t\t\tfooterPaddingLeft:marginL,//jsonObj.pageStyles.footerPaddingLeft,\r\n\t\t\t\tfooterPaddingRight:marginR,//jsonObj.pageStyles.footerPaddingRight,\t\t\t\t\r\n\t\t\t\t// totWidth:jsonObj.pageStyles.pageWidth,\r\n\t\t\t\tcentralWidth:centralWidthHeader,\r\n\t\t\t\tlateralMargin:\"80\"\r\n\t\t\t});\t\r\n\t\t\t$(\"#templateHolder\").empty();\r\n\t\t\t$(emailTemplate).appendTo('body');//place emailTemplate HTML in DOM\r\n\t\t\t\r\n\t\t\tvar content = $(\"#templatePreview\").html();\r\n\t\t\t// var template = _.template($(\"#templatePreview\").html());\r\n\t\t\tvar header = $(\"#template_holder_header\");\r\n\t\t\tvar body = $(\"#template_holder_body\");\r\n\t\t\tvar footer = $(\"#template_holder_footer\");\r\n\t\t\theader.empty();\r\n\t\t\tbody.empty();\r\n\t\t\tfooter.empty();\r\n\t\t\tFL.login.emailImagesArray = [];\r\n\t\t\t// mountTemplate(jsonObj,header,body,footer);\r\n\t\t\twindow.templateCounter = 0;\r\n\t\t\tappendTemplate(jsonObj.templateItems.header,header,centralWidthHeader,percent,marginL,marginR,jsonObj.pageStyles.headerBgColor);//fills header template with header content extracted from jsonObj\r\n\t\t\tappendTemplate(jsonObj.templateItems.body,body,centralWidthHeader,percent,marginL,marginR,jsonObj.pageStyles.bodyBgColor);//fills body template with body content extracted from jsonObj\r\n\t\t\tappendTemplate(jsonObj.templateItems.footer,footer,centralWidthHeader,percent,marginL,marginR,jsonObj.pageStyles.footerBgColor);//fills footer template with footer content extracted from jsonObj\r\n\t\t\t\r\n\t\t\tvar emailJQ = $(emailTemplate);\r\n\t\t\temailJQ.find(\"#template_holder_header\").append(header.contents());\r\n\t\t\temailJQ.find(\"#template_holder_body\").append(body.contents());\r\n\t\t\temailJQ.find(\"#template_holder_footer\").append(footer.contents());\r\n\t\t\t// return $(\"#templateHolder\").html();\r\n\t\t\tvar z=$(emailJQ).html();\r\n\t\t\treturn $(emailJQ).html();\r\n\t\t};\t\t\r\n\t\tvar convertsToArrOfObj = function(templateOptionsArr){\r\n\t\t\t//receives [{\"_id\": \"t 115\",jsonTemplate:\"dfdfdg\"},{\"_id\": \"t 116\",jsonTemplate:\"dfgd\"}] and returns [{value:1,text: \"t 115\",template:\"dfdfdg\"},{value:2,text: \"t 116\",template:\"dfgd\"}]\r\n\t\t\treturn _.map(templateOptionsArr, function(el,index){ return {\"value\":index+1,\"text\":el._id,\"template\":el.jsonTemplate}; });\r\n\t\t};\r\n\t\tvar extractSenderObjFromModal = function() { //extracts senderObj from _sendNewsletterTemplate\r\n\t\t\tvar name = $(\"#_sendNewsletter_name\").val();\r\n\t\t\tvar email = $(\"#_sendNewsletter_email\").val();\r\n\t\t\tvar subject = $(\"#_sendNewsletter_subject\").val();\r\n\t\t\tvar testEmail =  $(\"#_sendNewsletter_testEmail\").val();\r\n\t\t\tvar senderObj = {from_name:name,from_email:email,subject:subject,testEmail:testEmail};\r\n\t\t\treturn senderObj;\r\n\t\t};\t\t\t\r\n\t\tvar newsletterEmissionUI = function(templateOptionsArr, entityName, grid, emailAttributeName) {//grid is the backgrid object necessary for select\r\n\t\t\tvar def = $.Deferred();\r\n\t\t\tFL.login.emailTemplateName = null;//cleans any previous template name\r\n\t\t\tFL.login.emailContentTemplate = null;\r\n\t\t\tFL.login.emailImagesArray = [];\r\n\t\t\tvar arrOfObj = convertsToArrOfObj(templateOptionsArr); //converts templateOptionsArr to arrOfObjects\r\n\t\t\t//ex:arrOfObj=[{value:1,text: \"t 115\",template:\"dfdfdg\"},{value:2,text: \"t 116\",template:\"dfgd\"}]\r\n\r\n\t\t\tvar pos = FL.login.token.userName.indexOf(\"@\");\r\n\t\t\tvar shortUserName = FL.login.token.userName.substring(0,pos);\r\n\t\t\tvar masterDetailItems = {\r\n\t\t\t\tmaster:{toEmail:shortUserName,email:FL.login.token.userName,subject:\"\",testEmail:FL.login.token.userName},\r\n\t\t\t\tdetail:{} //no detail\r\n\t\t\t};\r\n\t\t\tvar options = {\r\n\t\t\t\ttype:\"primary\", \r\n\t\t\t\ticon:\"send\",\r\n\t\t\t\tbutton1:\"Cancel\",\r\n\t\t\t\tbutton2:\"Send Newsletter\",\r\n\t\t\t\tdropdown:{\r\n\t\t\t\t\t\"_sendNewsletter_template\":{\r\n\t\t\t\t\t\tarr:arrOfObj,//titles,\r\n\t\t\t\t\t\tdefault:\"No template\",\r\n\t\t\t\t\t\tonSelect:function(objSelected){// FL.common.printToConsole(\"Template choice was \"+objSelected.text + \" cId=\" + objSelected.cId);\r\n\t\t\t\t\t\t\tFL.login.emailTemplateName = objSelected.text;\r\n\t\t\t\t\t\t\tvar htmlTemplate = getHTMLContent(objSelected.template);\r\n\t\t\t\t\t\t\tFL.login.emailContentTemplate = htmlTemplate;\r\n\t\t\t\t\t\t\t// alert(\"Template choice was \"+objSelected.text);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tFL.common.editMasterDetail(\"B\",\" Send email/Newsletter\",\"_sendNewsletterTemplate\",masterDetailItems,options,function(result){\r\n\t\t\t\tif(result){//user choosed button2 ==>Send Newsletter button\r\n\t\t\t\t\tif(FL.login.emailTemplateName !== null){\t\t\t\t\t\r\n\t\t\t\t\t\t// var toArr = csvStore.extractEmailArray();//to arr becomes: [{\"email\":\"e1@live.com\"},{\"email\":\"email2@gmail.com\"}..]\r\n\t\t\t\t\t\tvar toArr = getSelectedEmailArray(grid,emailAttributeName);//to arr becomes: [{\"email\":\"e1@live.com\"},{\"email\":\"email2@gmail.com\"}..]\r\n\t\t\t\t\t\tif( toArr.length == 0 ){\r\n\t\t\t\t\t\t\tFL.common.makeModalInfo(\"No email to send. To send one or more emails, click the left column checkbox.\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tvar senderObj = extractSenderObjFromModal();//var senderObj = {from_name:name,from_email:email,subject:subject,testEmail:testEmail};\r\n\t\t\t\t\t\t\tvar mailHTML = FL.login.emailContentTemplate;// we also have FL.login.emailTemplateName\r\n\t\t\t\t\t\t\t// alert(\"FLmenulinks2 newsletterEmissionUI Ready to send after checking duplicates.....template=\" + mailHTML);\r\n\t\t\t\t\t\t\tcheckDuplicateEmission(entityName,FL.login.emailTemplateName,toArr,senderObj);\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tFL.common.makeModalInfo(\"Canceled !!! No template selected.\");\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\tFL.common.makeModalInfo(\"Canceled !!! you can always send these emails later...\");\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\treturn def.resolve();\r\n\t\t\t});\t\t\t\r\n\t\t\treturn def.promise();\r\n\t\t};\t\r\n\t\tvar getSelectedEmailArray = function(grid,emailAttributeName){//TEM DE RECEBER A GRID !!!!\r\n            var emailsArr = [];\r\n            var selectedModels = grid.getSelectedModels();\r\n            if(selectedModels.length > 0 ){\r\n            \t// alert(\"FLGrid2 selectedModels=\"+selectedModels);\r\n            \t_.each(selectedModels,function(element,index){\r\n            \t\temailsArr.push( element.attributes[emailAttributeName] );\r\n            \t});\r\n            }\r\n            return emailsArr;\t\r\n\t\t};\r\n\t\tvar prepareNewsletterEmission = function(entityName,grid,emailAttributeName){\r\n\t\t\tvar getTemplatesPromise = FL.API.loadTableId(\"_templates\",\"jsonTemplate\");//(\"_templates\",\"jsonTemplate\");\r\n\t\t\tvar entityName = entityName;\r\n\t\t\tgetTemplatesPromise.done(function(data){\r\n\t\t\t\tFL.common.printToConsole(\">>>>>FLGrid2.js prepareNewsletterEmission  SUCCESS <<<<<\");\r\n\t\t\t\tif( data.length === 0 ){\r\n\t\t\t\t\tFL.common.makeModalInfo('No templates available. You must have at least one template saved.');\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// aGrid2nulinks2.js prepareNewsletterEmission =>\\n\" + JSON.stringify(data));//data array of objects\r\n\t\t\t\t\tvar emissionPromise = newsletterEmissionUI(data,entityName,grid,emailAttributeName);\r\n\t\t\t\t\temissionPromise.done(function(data){\r\n\t\t\t\t\t\tFL.common.printToConsole(\"FLmenulinks2 prepareNewsletterEmission emission done !\");\r\n\t\t\t\t\t\treturn;// def.resolve(data);\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t\temissionPromise.fail(function(){\r\n\t\t\t\t\t\talert(\"FLmenulinks2 prepareNewsletterEmission ->ERROR !!!\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tgetTemplatesPromise.fail(function(err){\r\n\t\t\t\tFL.common.printToConsole(\">>>>>FLGrid2.js prepareNewsletterEmission  FAILURE <<<<<\"+err);\r\n\t\t\t\treturn;\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar getMailchimpHTML = function(cId) {\r\n\t\t\tvar def = $.Deferred();\r\n\t\t\tvar arr = null;\r\n\t\t\tvar fl = FL.fl;\r\n\t\t\tif(fl){\r\n\t\t\t\tvar mc = new fl.mailChimp();\r\n\t\t\t\tmc.campaignContent({cid: cId}, function(err, data){\r\n\t\t\t\t\tif(!err){\r\n\t\t\t\t\t\tFL.common.printToConsole(\"campaignlist returns no error data=\"+JSON.stringify(data.html));\r\n\t\t\t\t\t\tdef.resolve(data.html);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn def.reject( \"FLmenulink2.js getMailchimpHTML - ERROR:\"+err );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\treturn def.reject(\"FLmenulink2.js getMailchimpHTML ->ERROR: token is empty\");\r\n\t\t\t}\r\n\t\t\treturn def.promise();\r\n\t\t};\t\t\r\n\t\tvar getMailchimpTemplates = function() {\r\n\t\t\tvar def = $.Deferred();\r\n\t\t\tvar arr = null;\r\n\t\t\tvar fl = FL.fl;\r\n\t\t\tif(fl){\r\n\t\t\t\tvar mc = new fl.mailChimp();\r\n\t\t\t\tmc.campaignList( {data:1}, function(err, data){\r\n\t\t\t\t\t// FL.common.printToConsole(\"campaignlist returns no error data=\"+JSON.stringify(data.data));\r\n\t\t\t\t\tif(!err){\r\n\t\t\t\t\t\tvar arrOfObj = [];\r\n\t\t\t\t\t\tvar item = null;\r\n\t\t\t\t\t\t_.each(data.data, function(element,index){\r\n\t\t\t\t\t\t\titem = {value:index,text:element.title,cId:element.id};\r\n\t\t\t\t\t\t\tarrOfObj.push(item);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// arrCid = _.pluck(data.data,\"id\");\r\n\t\t\t\t\t\t// arrTitles = _.pluck(data.data,\"title\");\r\n\t\t\t\t\t\tdef.resolve(arrOfObj);\r\n\t\t\t\t\t\t// oneCampaign=data.data[data.data.length-1];\r\n\t\t\t\t\t\t// FL.common.printToConsole(\"requesting content for cid: \" + oneCampaign.id);\t\t\t\t\t\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn def.reject( \"FLmenulink2.js getTemplates -ERROR:\"+err );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\treturn def.reject(\"FLmenulink2.js getTemplates ->ERROR: token is empty\");\r\n\t\t\t}\r\n\t\t\treturn def.promise();\r\n\t\t};\t\t\r\n\t\tvar prepareNewsletterMCEmission = function(entityName){\r\n\t\t\t//collects all data to send a newsletter to the current grid. Including the template to use.\r\n\t\t\tFL.login.emailTemplateName = null;//cleans any previous template name\r\n\t\t\tvar pos = FL.login.token.userName.indexOf(\"@\");\r\n\t\t\tvar shortUserName = FL.login.token.userName.substring(0,pos);\r\n\t\t\tvar masterDetailItems = {\r\n\t\t\t\tmaster:{toEmail:shortUserName,email:FL.login.token.userName,subject:\"\",testEmail:FL.login.token.userName},\r\n\t\t\t\tdetail:{} //no detail\r\n\t\t\t};\r\n\t\t\t// prepares FL.common.editMasterDetail options (including the templates dropdown)\r\n\t\t\tFL.login.emailContentTemplate = null;\r\n\t\t\tvar getTemplatesPromise = getMailchimpTemplates();\r\n\t\t\tgetTemplatesPromise.done(function(arrOfObj){ \t\r\n\t\t\t\t// alert(\"getTemplatesPromise done getTemplates-->\"+_.pluck(arrOfObj,\"text\"));\r\n\t\t\t\tvar options = {\r\n\t\t\t\t\ttype:\"primary\", \r\n\t\t\t\t\ticon:\"send\",\r\n\t\t\t\t\tbutton1:\"Cancel\",\r\n\t\t\t\t\tbutton2:\"Send MC Newsletter\",\r\n\t\t\t\t\tdropdown:{\r\n\t\t\t\t\t\t\"_sendNewsletter_template\":{\r\n\t\t\t\t\t\t\tarr:arrOfObj,//titles,\r\n\t\t\t\t\t\t\tdefault:\"No template\",\r\n\t\t\t\t\t\t\tonSelect:function(objSelected){// FL.common.printToConsole(\"Template choice was \"+objSelected.text + \" cId=\" + objSelected.cId);\r\n\t\t\t\t\t\t\t\t//now we will get the html for the selected cId saving it in FL.login.emailContentTemplate for future consummation\r\n\t\t\t\t\t\t\t\tvar getMailchimpHTMLPromise = getMailchimpHTML(objSelected.cId);\r\n\t\t\t\t\t\t\t\tgetMailchimpHTMLPromise.done(function(data){\r\n\t\t\t\t\t\t\t\t\t// alert(\"getMailchimpHTMLPromise OK =>\"+JSON.stringify(data));\r\n\t\t\t\t\t\t\t\t\tFL.login.emailContentTemplate = data;\r\n\t\t\t\t\t\t\t\t\tFL.login.emailTemplateName = objSelected.text;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tgetMailchimpHTMLPromise.fail(function(err){\r\n\t\t\t\t\t\t\t\t\tFL.common.printToConsole(\">>>>>FLGrid2.js prepareNewsletterMCEmission onSelect inside dropdown FAILURE <<<<<\"+err);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tFL.common.editMasterDetail(\"B\",\" Send MC email/Newsletter\",\"_sendNewsletterTemplate\",masterDetailItems,options,function(result){\r\n\t\t\t\t\tif(result){//user choosed button2 ==>Send Newsletter button\r\n\t\t\t\t\t\t// FL.links.testEmail();\r\n\t\t\t\t\t\tvar senderObj = extractSenderObjFromModal();//var senderObj = {from_name:name,from_email:email,subject:subject,testEmail:testEmail};\r\n\t\t\t\t\t\tvar toArr = csvStore.extractEmailArray();//to arr becomes: [{\"email\":\"e1@live.com\"},{\"email\":\"email2@gmail.com\"}..]\r\n\t\t\t\t\t\tvar mailHTML = FL.login.emailContentTemplate;\r\n\t\t\t\t\t\t// alert(\"before calling checkDuplicate ->\"+FL.login.emailTemplateName);\r\n\t\t\t\t\t\tif(FL.login.emailTemplateName !== null)\r\n\t\t\t\t\t\t\tcheckDuplicateEmission(entityName,FL.login.emailTemplateName,toArr,senderObj);//CURRENTLY var IN FLmenulinks2.js \r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tFL.common.makeModalInfo(\"Canceled !!! No template selected.\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// alert(\"newsletter canceled\");\r\n\t\t\t\t\t\tFL.common.makeModalInfo(\"Canceled !!! you can always send these emails later...\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t});\r\n\t\t\tgetTemplatesPromise.fail(function(err){\r\n\t\t\t\tFL.common.printToConsole(\">>>>>FLGrid2.js prepareNewsletterMCEmission  FAILURE <<<<<\"+err);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar checkDuplicateEmission = function(entityName,NName,toSend,senderObj){\r\n\t\t\t// Assumes that NNAme is not null\r\n\t\t\t// This method manages the users dialogs for the following cases:\r\n\t\t\t//\t\tFirst time emission - the newsletter was not sent before ->sends  to missingEmails = the whole list (recipientsArr)\r\n\t\t\t//\t\tRemission to all recipients - The same newsletter was sent previously - DANGEROUS !!!!\r\n\t\t\t//         missing are null in this case ->\r\n\t\t\t//\t\tEmission to new recipients that were introduced in the base table, after the last emission - sends to the missingEmails\t\t\tvar promise = FL.API.mailRecipientsOfTemplate(entityName,NName);\r\n\t\t\tvar promise = FL.API.mailRecipientsOfTemplate(entityName,NName);\r\n\t\t\tpromise.done(function(sent){\r\n\t\t\t\t// var toSend =  _.pluck(recipientsArr, \"email\");\r\n\t\t\t\tFL.common.printToConsole(\"==========================================\");\r\n\t\t\t\tFL.common.printToConsole(\"toSend->\"+JSON.stringify(toSend));\r\n\t\t\t\tvar missingEmails = _.difference(toSend, sent); //if sent = null =>missing = toSend\r\n\r\n\t\t\t\t// missingEmails = [];//TEST CASE 2 - REEMISSION\r\n\t\t\t\t// missingEmails.splice(0,2);//TEST CASE 3 - NEW ADDITIONS - remove position 0 and 1\r\n\t\r\n\t\t\t\tFL.common.printToConsole(\"Emails to sent->\"+JSON.stringify(missingEmails));\r\n\t\t\t\t// alert(\"missingEmails->\"+JSON.stringify(missingEmails));\r\n\t\t\t\tvar confirmQuestion = null;\r\n\t\t\t\tvar button2 = null;\r\n\t\t\t\tif(missingEmails.length == toSend.length){\r\n\t\t\t\t\tconfirmQuestion = \"Do you confirm the emission of \" + toSend.length + \" emails, using template '\" + NName + \"' ?\";\r\n\t\t\t\t\tbutton2 = \"OK execute first emission\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar missingHTML = \"\";\r\n\t\t\t\t\t_.each(missingEmails,function(element){\r\n\t\t\t\t\t\tmissingHTML += \"<li>\" + element + \"</li>\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconfirmQuestion = NName + \" was sent previously, but \" + missingEmails.length + \" new recipient(s) were added to the send list.<br>Do you want to send only to the new recipient(s) ?<br>\"+missingHTML;\r\n\t\t\t\t\tbutton2 = \"OK send to \" + missingEmails.length + \" new email(s)\";\r\n\t\t\t\t\tif(missingEmails.length ==0){\r\n\t\t\t\t\t\tconfirmQuestion = \"This emission of \" + NName + \" was done previously to the same recipients !!! Do you really want to repeat it ?\";\r\n\t\t\t\t\t\tbutton2 = \"OK resend these emails\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tFL.common.makeModalConfirm(confirmQuestion,\"No, cancel the emission\",button2, function(result){\r\n\t\t\t\t\tif(result){\r\n\t\t\t\t\t\tvar mailHTML = FL.login.emailContentTemplate;\r\n\t\t\t\t\t\tvar imagesArr = FL.login.emailImagesArray;\r\n\t\t\t\t\t\t// mailHTML = null; //to TEST ONLY\r\n\t\t\t\t\t\tvar msg = \"Newsletter \" + FL.login.emailTemplateName + \" was not sent !!!. No content to send.\";\r\n\t\t\t\t\t\tif(mailHTML!== null){\r\n\t\t\t\t\t\t\tif(  button2 == \"OK resend these emails\") {\r\n\t\t\t\t\t\t\t\tmissingEmails = toSend; //missingEmails now refers to toSend\r\n\t\t\t\t\t\t\t\t// alert(\"Resend the emission ->\"+JSON.stringify(missingEmails));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// var sentCount = FL.links.sendEmail(entityName,mailHTML,imagesArr,missingEmails,senderObj,FL.login.emailTemplateName);\r\n\t\t\t\t\t\t\tvar eCN = FL.dd.getCEntity(FL.dd.histoMailPeer(entityName));\r\n\t\t\t\t\t\t\tvar fCN = FL.dd.getFieldCompressedName(FL.dd.histoMailPeer(entityName),\"msg\");\r\n\t\t\t\t\t\t\tvar metadataObj={newsletterName:FL.login.emailTemplateName,dbName:FL.login.token.dbName,eCN:eCN,fCN:fCN}\r\n\t\t\t\t\t\t\t// var sentCount = FL.emailServices.sendEmail(entityName,mailHTML,imagesArr,missingEmails,senderObj,metadataObj);\r\n\t\t\t\t\t\t\tvar sentCount = FL.emailServices.sendEmail(mailHTML,imagesArr,missingEmails,senderObj,metadataObj);\r\n\t\t\t\t\t\t\t// var sentCount = missingEmails.length;\r\n\t\t\t\t\t\t\tmsg = \"Newsletter \" + FL.login.emailTemplateName + \" sent  to \" + sentCount + \" recipients !!!<br> - total rows checked = \"+toSend.length;\r\n\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\tFL.common.makeModalInfo(msg);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tFL.common.makeModalInfo(\"Canceled !!! you can always send these emails later...\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tpromise.fail(function(){\r\n\t\t\t\talert(\"checkDuplicateEmission ->ERROR !!!\");\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar getLookupInGrid = function(oLayout) {//\r\n\t\t\tvar lookupObj = null\r\n\t\t\tFL.dd.init_t();//to init the temporary subsystem\r\n\t\t\t_.each(oLayout.format, function(element) {//each element of oLayout.format array is like {fCN:\"50\",\"1st Column\",width:20,nestingArr:[]}\r\n\t\t\t\tvar field = FL.dd.t.entities[oLayout.baseTable].fields[element.fCN];\r\n\t\t\t\tif(field.typeUI==\"lookupbox\")\r\n\t\t\t\t\tlookupObj = field.specialTypeDef;//{eCN:<entity compressed name>, fCN:<field compressed name>}\r\n\t\t\t});\r\n\t\t\treturn lookupObj;\r\n\t\t};\r\n\t\tvar mountGridFromColumnsArr = function(columnsArr,eCN) {//\r\n\t\t\t// alert(\"mountGridFromColumnsArr ->\" + JSON.stringify(columnsArr));\r\n\t\t\t// return;\r\n\t\t\tvar entityName = FL.dd.getEntityByCName(eCN);\r\n\t\t\tFL.common.printToConsole(\"New &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& entity=\"+entityName);\r\n\t\t\tFL.common.printToConsole(\"show columnsArr=\"+JSON.stringify(columnsArr));\r\n\t\t\t// FL.common.spin(false);\r\n\t\t\t// spinner.stop();\r\n\t\t\tFL.common.clearSpaceBelowMenus();\r\n\t\t\t$(\"#addGrid\").show();\r\n\t\t\t$(\"#addGrid\").html(\" Add Row\");\r\n\t\t\t$('#_editGrid').off('click');\r\n\t\t\t$(\"#_editGrid\").click(function(){\r\n\t\t\t\teditGrid(entityName);\r\n\t\t\t});\t\t\t\t\r\n\t\t\t$(\"#_editGrid\").show();\r\n\t\t\t// var eCN = FL.dd.getCEntity(entityName);//to remove later when we change entityName by eCN\r\n\t\t\tvar emailAttributeName = FL.dd.firstEmailAttribute(eCN);\r\n\t\t\tif(emailAttributeName) {\r\n\t\t\t\t$('#_newsletter').off('click');\r\n\t\t\t\t$(\"#_newsletter\").click(function(){\r\n\t\t\t\t\tvar templatePromise=FL.API.createTemplates_ifNotExisting();\r\n\t\t\t\t\ttemplatePromise.done(function(){\r\n\t\t\t\t\t\t// alert(\"FLGrid2 l1143 grid = \"+grid);\r\n\t\t\t\t\t\tprepareNewsletterEmission(entityName,grid,emailAttributeName);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttemplatePromise.fail(function(err){\r\n\t\t\t\t\t\talert(\"FLmenulinks2.js set3ButtonsAndGrid ->FAILURE with createTemplates_ifNotExisting err=\"+err);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\t$('#_newsletter').show();\r\n\t\t\t\t$('#_newsletterMC').off('click');\r\n\t\t\t\t$(\"#_newsletterMC\").click(function(){\r\n\t\t\t\t\tprepareNewsletterMCEmission(entityName);\r\n\t\t\t\t});\t\t\t\t\t\t\t\r\n\t\t\t\t$('#_newsletterMC').show();\r\n\t\t\t\t$(\"#_newsletterMC\").html(\" MC\");\r\n\t\t\t}\r\n\t\t\tvar grid = utils.mountGridInCsvStore(columnsArr);//mount backbone views and operates grid -\t\r\n\t\t\tFL.API.serverCallBlocked = false;\r\n\t\t};\t\t\r\n\t\tvar internalTest = function(x) {//\r\n\t\t\talert(\"grid internalTest() -->\"+x);\r\n\t\t};\r\n\t\treturn{\r\n\t\t\t// getPageNo: function(pagName){ //to be used by savePage and restorePage\r\n\t\t\t// \tvar pageNoObj = {\"home\":1,\"about\":2};\r\n\t\t\t// \treturn  pageNoObj[pagName];\r\n\t\t\t// },\r\n\t\t\tcsvFile: null,\r\n\t\t\tcsvFileDelimiter: null,\r\n\t\t\tcsvEncoding: null,\r\n\t\t\tcreateGrid: function() {//call with menu key \"uri\": \"javascript:FL.grid.createGrid()\"\r\n\t\t\t\tvar masterDetailItems = {\r\n\t\t\t\t\tmaster:{entityName:\"sample\",headerString:\"\"},\r\n\t\t\t\t\tdetail:{} //format is array with {attribute:<attribute name>,description:<attr description>,statement;<phrase>}\r\n\t\t\t\t};\r\n\t\t\t\tvar options = {\r\n\t\t\t\t\ttype:\"primary\", \r\n\t\t\t\t\ticon:\"th\",\r\n\t\t\t\t\tbutton1:\"Cancel\",\r\n\t\t\t\t\tbutton2:\"Create Grid\"\r\n\t\t\t\t};\r\n\t\t\t\tFL.common.editMasterDetail(\"B\",\" Create Grid\",\"_createGridTemplate\",masterDetailItems,options,function(result){\r\n\t\t\t\t\tif(result){//user choosed create\r\n\t\t\t\t\t\t// FL.links.testEmail();\r\n\t\t\t\t\t\tvar entityName = $(\"#_createGrid_entityName\").val();\r\n\t\t\t\t\t\tvar headerString = $(\"#_createGrid_header\").val();\r\n\t\t\t\t\t\t// alert(\"Title:\"+entityName+\"-->\"+headerString);\r\n\t\t\t\t\t\tif(entityName === \"\" || headerString === \"\")\r\n\t\t\t\t\t\t\tFL.common.makeModalInfo(\"Empty sample or headerString => nothing to do\");\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tvar arrOfColumns =prepareAttributesArr(headerString);\r\n\t\t\t\t\t\t\tinjectId(\"id\",arrOfColumns); //now the first column is an \"id\" column\r\n\t\t\t\t\t\t\tif(FL.dd.createEntityAndFields(entityName,\"description of \"+entityName,arrOfColumns)){\r\n\t\t\t\t\t\t\t\tvar columnsArr = utils.backGridColumnsFromArray(arrOfColumns);//extracts attributes from dictionary and prepares columns object for backgrid\r\n\t\t\t\t\t\t\t\tcsvStore.setAttributesArr(arrOfColumns);//saves arrOfColumns on csvStore -  [{label:\"xx\",name:fieldName,description:xDescription,type:xtype,enumerable:xEnumerable},{col2}...{}]\r\n\t\t\t\t\t\t\t\tvar emptyRowArr = prepareOneEmptyRowArray(arrOfColumns);\r\n\t\t\t\t\t\t\t\tFL.grid.csvToStore(emptyRowArr); //feeds the csvStore data store object. It inserts id element and converts keys to lowercase\r\n\t\t\t\t\t\t\t\tFL.common.clearSpaceBelowMenus();\r\n\t\t\t\t\t\t\t\tutils.mountGridInCsvStore(columnsArr);//mount backbone views and operates grid - columnsArr must be prepared to backGrid\r\n\t\t\t\t\t\t\t\tvar promise = FL.grid.storeCurrentCSVToServerAndInsertMenu(entityName);\r\n\t\t\t\t\t\t\t\tpromise.done(function(){\r\n\t\t\t\t\t\t\t\t\tFL.grid.displayDefaultGrid(entityName);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tpromise.fail(function(err){\r\n\t\t\t\t\t\t\t\t\talert(\"FLgrid2.js createGrid Error:\"+err);\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tFL.common.makeModalInfo(\"The entity name '\" + entityName + \"' already exist. Please choose another name.\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// alert(\"Create Grid canceled\");\r\n\t\t\t\t\t\tFL.common.makeModalInfo(\"Create Grid canceled\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tadjustRowsToAttributes: function(rows,arrOfAttributes){\r\n\t\t\t\tadjustRowsToAttributes(rows,arrOfAttributes);\r\n\t\t\t},\r\n\t\t\tverifyPapaFields: function(metaFieldsArr){\r\n\t\t\t\t//Ex  metaFieldsArr has :{aborted: false, cursor: 322587, delimiter: \",\",fields: Array[52],linebreak: \"\",truncated: false}\r\n\t\t\t\t//This is the place to add some inteligence in evaluation of CSV files.\r\n\t\t\t\t//   for the time being the only criteria to refuse is aborted\r\n\t\t\t\t//verifies if there are empty fields. If they exist flags an error. \r\n\t\t\t\t//\tif delimiter diferent from null means that probabily the delimiter is the specified\r\n\t\t\t\t//  NOTE: to choose the delimiter it checks the first field.\r\n\t\t\t\t//\t\t\tif fistfields has more \r\n\t\t\t\t//  encoding is the encoding recomendation - PC =>\r\n\t\t\t\tvar ok=true;\r\n\t\t\t\tvar fieldArray = metaFieldsArr.fields;\r\n\t\t\t\tvar numberOfFields = 0;\r\n\t\t\t\tvar emptyFields = 0;\r\n\t\t\t\tvar delimiter = null;\r\n\t\t\t\tvar linebreak = metaFieldsArr.linebreak;\r\n\t\t\t\tvar encoding = null;\r\n\t\t\t\tvar semi_colon_repetitions=0;\r\n\t\t\t\tvar comma_repetitions=0;\r\n\t\t\t\t_.each(fieldArray, function(element, index){\r\n\t\t\t\t\tnumberOfFields++;\r\n\t\t\t\t\tif(index==0){//check semicolumns anbd comma repetiions on firtst line\r\n\t\t\t\t\t\tsemi_colon_repetitions=( element.match(/;/g) || [] ).length;\r\n\t\t\t\t\t\tcomma_repetitions=( element.match(/,/g) || [] ).length;\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(element === \"\"){\r\n\t\t\t\t\t\temptyFields++;\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif(metaFieldsArr.aborted)\r\n\t\t\t\t\tok=false;//one criteria to repeat\r\n\t\t\t\tif(linebreak.length == 1 && linebreak.charCodeAt(0)==13 )\r\n\t\t\t\t\tencoding=\"MacRoman\";//standard for mac\r\n\t\t\t\telse if(linebreak.length == 2 && linebreak.charCodeAt(0)==13 && linebreak.charCodeAt(1)==10 ) //CR + LF\r\n\t\t\t\t\tencoding=\"windows-1252\";//standard for PC\r\n\t\t\t\telse \r\n\t\t\t\t\tencoding=\"windows-1252\";//standard for PC\r\n\t\t\t\tif(emptyFields>0){\r\n\t\t\t\t\tif(semi_colon_repetitions>numberOfFields){ //one heuristic criteria\r\n\t\t\t\t\t\tdelimiter = \";\"//recomended for next try\r\n\t\t\t\t\t\tok=false;//one criteria to repeat\r\n\t\t\t\t\t}else if(comma_repetitions>numberOfFields){\r\n\t\t\t\t\t\tdelimiter = \",\"\r\n\t\t\t\t\t\tok=false;//one criteria to repeat\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn {ok:ok,linebreak:linebreak,delimiter:delimiter,encoding:encoding,numberOfFields:numberOfFields,emptyFields:emptyFields,comma_repetitions:comma_repetitions,semi_colon_repetitions:semi_colon_repetitions};\r\n\t\t\t},\r\n\t\t\tvalidateCSV: function(fileObj){//this is called directly from template id=\"_importCSV\" ->onchange=\"FL.grid.validateCSV(this.files)\" \r\n\t\t\t\t// if there is an error FL.grid.csvFile will be null. No error => FL.grid.csvFile = csvFile\r\n\t\t\t\t// all this does is to leave a message in FL.grid.csvFile after verifing possible CSV errors !!!!\r\n\t\t\t\t// The real treatment to the csvFile is done in FL.grid.importGrid() using FL.grid.csvFile prepared in FL.grid.validateCSV()\r\n\t\t\t\t\r\n\t\t\t\t// alert(\"validateCSV---->\"+fileObj[0].name + \" type=\"+fileObj[0].type + \" Elements=\" + fileObj.length);\r\n\t\t\t\tif(fileObj[0].name == \"\"){\r\n\t\t\t\t\talert(\"FL.grid.validateCSV() Error File Name Is empty\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// alert(\"File Name not empty\");\r\n\t\t\t\t\tvar csvFile = fileObj[0];\r\n\t\t\t\t\tFL.grid.csvFile = fileObj[0];\r\n\t\t\t\t\tFL.grid.csvFileDelimiter = null;\r\n\t\t\t\t\tPapa.parse(csvFile, {\r\n\t\t\t\t\t\theader: true,\r\n\t\t\t\t\t\tdynamicTyping: true,\r\n\t\t\t\t\t\tcomplete: function(results) {\r\n\t\t\t\t\t\t\tdata = results;\r\n\t\t\t\t\t\t\tvar rowsOnAttempt1 = results.data.length;\r\n\t\t\t\t\t\t\t// alert(\"Loaded rows:\" + rowsOnAttempt1 +  \"\\nAborted--->\" + results.meta.aborted + \"\\nDelimiter--->\"+JSON.stringify(results.meta.delimiter) + \"\\nFields--->\"+JSON.stringify(results.meta.fields) + \"\\n Errors--->\"+JSON.stringify(results.errors));\r\n\t\t\t\t\t\t\tvar resultObj = FL.grid.verifyPapaFields(results.meta);\r\n\t\t\t\t\t\t\t// alert(\"Result of verification:-->\"+JSON.stringify(resultObj));\r\n\t\t\t\t\t\t\tFL.grid.csvEncoding = resultObj.encoding;\r\n\t\t\t\t\t\t\tif(resultObj.ok){\r\n\t\t\t\t\t\t\t\tFL.common.printToConsole(\"OK on first attempt !!!!!!!!!!!!!! FILE IS A GOOD CSV \");\r\n\t\t\t\t\t\t\t\t// alert(\"OK on first attempt !!!!!!!!!!!!!! FILE IS A GOOD CSV \");\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t//SECOND ATTEMPT we will try again forcing the delimiter\r\n\t\t\t\t\t\t\t\t// FL.grid.csvFile = null;\r\n\t\t\t\t\t\t\t\tFL.grid.csvFileDelimiter = resultObj.delimiter;\r\n\t\t\t\t\t\t\t\tPapa.parse(csvFile, {\r\n\t\t\t\t\t\t\t\t\tdelimiter: resultObj.delimiter,\r\n\t\t\t\t\t\t\t\t\tdynamicTyping: true,\r\n\t\t\t\t\t\t\t\t\tencoding: resultObj.encoding,\r\n\t\t\t\t\t\t\t\t\tcomplete: function(results) {\r\n\t\t\t\t\t\t\t\t\t\tdata = results;\r\n\t\t\t\t\t\t\t\t\t\tif (results.data.length<rowsOnAttempt1){//refuse because lines will be lost\r\n\t\t\t\t\t\t\t\t\t\t\tFL.grid.csvFile = null;//to block the import\r\n\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\talert(\"attempt 2 --> !!!! Loaded rows:\" + results.data.length +  \"\\nDelimiter--->\"+JSON.stringify(results.meta.delimiter) + \"\\nFields--->\"+JSON.stringify(results.meta.fields) + \"\\n Errors--->\"+JSON.stringify(results.errors));\r\n\t\t\t\t\t\t\t\t\t\t\tvar resultObj = FL.grid.verifyPapaFields(results.meta);\r\n\t\t\t\t\t\t\t\t\t\t\talert(\"attempt 2 --->Result of verification:-->\"+JSON.stringify(resultObj));\r\n\t\t\t\t\t\t\t\t\t\t\tif(resultObj.ok){\r\n\t\t\t\t\t\t\t\t\t\t\t\talert(\"OK AT SECOND ATTEMPT !!!!!!!!!!!!!! FILE IS A GOOD CSV \");\r\n\t\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\t\tFL.grid.csvFile = null;//to block the import\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\t\t\t\t\t\r\n\t\t\t\t}\t\r\n\t\t\t},\r\n\t\t\timportGrid: function() {//call with menu key \"uri\": \"javascript:FL.grid.importGrid()\" in Settings\r\n\t\t\t\t// The real treatment to the csvFile is done here  - FL.grid.importGrid() -  using FL.grid.csvFile prepared in FL.grid.validateCSV()\r\n\t\t\t\tvar masterDetailItems = {\r\n\t\t\t\t\tmaster:{entityName:\"\",fileName:\"jojo\"},\r\n\t\t\t\t\tdetail:{} //format is array with {attribute:<attribute name>,description:<attr description>,statement;<phrase>}\r\n\t\t\t\t};\r\n\t\t\t\tvar options = {\r\n\t\t\t\t\ttype:\"primary\", \r\n\t\t\t\t\ticon:\"cloud-upload\",\r\n\t\t\t\t\tbutton1:\"Cancel\",\r\n\t\t\t\t\tbutton2:\"Import CSV\"\r\n\t\t\t\t};\r\n\t\t\t\tFL.common.editMasterDetail(\"B\",\" Upload CSV\",\"_importCSV\",masterDetailItems,options,function(result){\r\n\t\t\t\t\tif(result){//user choosed create\r\n\t\t\t\t\t\t// FL.links.testEmail();\r\n\t\t\t\t\t\tvar entityName = $(\"#_importCSV_entityName\").val();\r\n\t\t\t\t\t\tvar fileName = $(\"#_importCSV_fileName\").val();\r\n\t\t\t\t\t\t// alert(\"Title:\"+entityName+\"-->\"+headerString);\r\n\t\t\t\t\t\tif(fileName === \"\")\r\n\t\t\t\t\t\t\t// alert(\"One missing ---> entityName=\"+entityName+\" fileName=\"+fileName);\r\n\t\t\t\t\t\t\tFL.common.makeModalInfo('No CSV file selection - Nothing was done');\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t//FL.ddcreateEntity()\r\n\t\t\t\t\t\t\t// alert(\"None missing ----> entityName=\"+entityName+\" fileName=\"+fileName);\r\n\t\t\t\t\t\t\tif(!FL.grid.csvFile){\r\n\t\t\t\t\t\t\t\tFL.common.makeModalInfo('There is a problem with ' + fileName + ' - Nothing was done');\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tFL.common.clearSpaceBelowMenus();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar csvFile = FL.grid.csvFile;//set by FL.grid.validateCSV(this.files) --- was val = $('input[type=file]');\r\n\t\t\t\t\t\t\t\tvar delimiter = FL.grid.csvFileDelimiter;\r\n\t\t\t\t\t\t\t\tvar encoding = FL.grid.csvEncoding;\r\n\t\t\t\t\t\t\t\tFL.grid.csvToGrid2(csvFile,delimiter,encoding,entityName);//csvFile is not a JQuery object\r\n\t\t\t\t\t\t\t}\r\n                \t\t\t// utils.mountGridInCsvStore(columnsArr);//mount backbone views and operates grid - columnsArr must be prepared to backGrid\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\talert(\"Create Grid canceled\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tcsvToStore:function(rows){//rows is an array of JSON [{},{}...{}]; each JSON  has a key/value = attribute/content\r\n\t\t\t\t//feeds the csvStore (memoryCsv.js)  with rows injecting id column and converting other column names to lower case\r\n\t\t\t\tvar csvrows = [];\r\n\t\t\t\t_.each( rows, function( element, index ) {\r\n\t\t\t\t\t// FL.common.printToConsole((index+1)+\" ---> \"+element[data.fields[0]] + \" --- \" + element[data.fields[6]]);//shows column 0 and column 6\r\n\t\t\t\t\telement[\"id\"] = index+1;//to insert id in element...\r\n\t\t\t\t\t//we need to be sure that each key is lowercase\r\n\t\t\t\t\tvar arrOfPairs = _.pairs(element);//returns an array w/ pairs [[\"one\", 1], [\"two\", 2], [\"three\", 3]]\r\n\t\t\t\t\tarrOfPairs =  _.map( arrOfPairs, function(value) {\r\n\t\t\t\t\t\treturn [ value[0], value[1] ];\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvar element2 = _.object(arrOfPairs);//reconstruct object from arrOf Pairs\r\n\t\t\t\t\tcsvrows.push(element2);\r\n\t\t\t\t});\r\n\t\t\t\tcsvStore.store(csvrows);\r\n\t\t\t},\r\n\t\t\tinsertDefaultGridMenu: function(singular,plural) {// Adds a menu with title <plural> and content displayDefaultGrid(<singular>)\r\n\t\t\t\t// cursor over menu position <plural> will show: javascript:FL.links.setDefaultGrid('<singular>')\r\n\t\t\t\t// if singular has spaces, they will be changed by \"_\"\r\n\t\t\t\tvar singularToUseInMenu = singular.replace(/ /g,\"_\");\r\n\t\t\t\t// var arrToSend = FL.grid.extractFromCsvStore(singular);\r\n\t\t\t\tvar arrToSend = csvStore.extractFromCsvStore(singular);\r\n\t\t\t\t// FL.common.printToConsole(\"FLGrid2.js --> insertDefaultGridMenu show arrToSend=\"+JSON.stringify(arrToSend));\r\n\t\t\t\t// format for arraTosend must be-->[{\"name\":\"Jojox\",\"phone\":\"123\"},{\"name\":\"Anton\",\"phone\":\"456\"}];\r\n\t\t\t\tvar saveTablePromise = FL.API.saveTable(singular,arrToSend);\r\n\t\t\t\tsaveTablePromise.done(function(data){\r\n\t\t\t\t\t// FL.common.printToConsole(\"FLGrid2.js --> insertDefaultGridMenu Succeded saving table. returned:\"+JSON.stringify(data));\r\n\t\t\t\t\tFL.common.clearSpaceBelowMenus();\r\n\t\t\t\t\t$.Topic( 'createGridOption' ).publish( plural,singularToUseInMenu );//broadcast that will be received by FL.menu to add an option\r\n\t\t\t\t});\r\n\t\t\t\tsaveTablePromise.fail(function(err){\r\n\t\t\t\t\talert(\"FLGrid2.js --> insertDefaultGridMenu FAILURE !!! err=\"+err);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tstoreCurrentCSVToServerAndInsertMenu: function(entityName,insertMenu){ //(entityName,plural) Adds a menu with title <plural> and content displayDefaultGrid(<singular>)\r\n\t\t\t\t// entityName- Name of entity that will be stored\r\n\t\t\t\t// insertMenu - true=> create new menu false=>no menu will be created\r\n\t\t\t\t// cursor over menu position <plural> will show: javascript:FL.links.setDefaultGridByCN('<eCN>')\r\n\t\t\t\t// if entityName has spaces, they will be changed by \"_\"\r\n\t\t\t\tvar def = $.Deferred();\r\n\t\t\t\tvar spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\t\t\tif(_.isUndefined(insertMenu) || insertMenu === null )\r\n\t\t\t\t\tinsertMenu = true;\r\n\t\t\t\tvar menuName = null;\r\n\t\t\t\tif(!entityName){\r\n\t\t\t\t\tentityName = FL.dd.nextEntityBeginningBy(\"unNamed\");\r\n\t\t\t\t\tmenuName = \"New Grid\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tmenuName = FL.dd.plural(entityName,\"En\");\r\n\t\t\t\t}\r\n\t\t\t\tFL.dd.createEntityAndFields(entityName,entityName+\" description\",csvStore.attributesArr);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t// var arrToSend = FL.grid.extractFromCsvStore();\r\n\t\t\t\tvar arrToSend = csvStore.extractFromCsvStore();\r\n\t\t\t\tvar saveTablePromise = FL.API.saveTable(entityName,arrToSend);\r\n\t\t\t\tsaveTablePromise.done(function(data){\r\n\t\t\t\t\tFL.common.printToConsole(\"FL.grid.storeCurrentCSVToServerAndInsertMenu --> dict synch and saveTable sucessfull ->\"+JSON.stringify(data));\r\n\t\t\t\t\tif(insertMenu){\r\n\t\t\t\t\t\tvar eCN = FL.dd.getCEntity(entityName);\r\n\t\t\t\t\t\tFL.login.permissionToAddMenu = true;//forces true...tis flag is set to false in FL.menu.topicCreateGridByCN to prevent 2 calls\r\n\t\t\t\t\t\t$.Topic( 'createGridOptionByCN' ).publish( menuName,eCN );//broadcast that will be received by FL.menu to add an option\r\n\t\t\t\t\t}\r\n\t\t\t\t\tFL.common.clearSpaceBelowMenus();\r\n\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\treturn def.resolve();\r\n\t\t\t\t\t// $.Topic( 'createGridOption' ).publish( plural,entityNameToUseInMenu );//broadcast that will be received by FL.menu to add an option\r\n\t\t\t\t});\r\n\t\t\t\tsaveTablePromise.fail(function(err){\r\n\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\talert(\"FL.grid.storeCurrentCSVToServerAndInsertMenu --> after successful synch->FAILURE in FL.API.saveTable err=\"+err);\r\n\t\t\t\t\tdef.reject(\"FL.grid.storeCurrentCSVToServerAndInsertMenu --> after successful synch->FAILURE in FL.API.saveTable err=\"+err);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t//--------------------- old code\r\n\t\t\t\tvar singularToUseInMenu = entityName.replace(/ /g,\"_\");\r\n\t\t\t\treturn def.promise();\r\n\t\t\t},\t\t\t\r\n\t\t\tupdateCurrentCSVToServer: function(entityName){ //update all records of entityName Table existing in dictionary\r\n\t\t\t\t// entityName- Name of entity that will be stored\r\n\t\t\t\t// if entityName has spaces, they will be changed by \"_\"\r\n\t\t\t\t// we will delete all records of entity name, and then insert all with the same _ids. \r\n\t\t\t\t//\t\tfd.remove(\"50\", {query:{}, single:{single:false}}, function(er, dr){\r\n\t\t\t\t//\t\tfd.insert(\"50\",[{_id:x1,d:{\"51\":\"cliente 1\",\"52\":\"Lisboa\",\"53\":\"Portugal\"}}, {_id:x2,d:{\"51\":\"cliente 2\",\"52\":\"Porto\",\"53\":\"Portugal\"}}])\r\n\t\t\t\tvar def = $.Deferred();\r\n\t\t\t\tif(FL.dd.isEntityInLocalDictionary(entityName)){\r\n\t\t\t\t\tvar spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\t\t\t\tvar eCN = FL.dd.getCEntity(entityName);\r\n\t\t\t\t\tvar removeAllPromise = FL.API.removeAllRecords(eCN);\r\n\t\t\t\t\tremoveAllPromise.done(function(data){\r\n\t\t\t\t\t\tFL.common.printToConsole(\"FL.grid.updateCurrentCSVToServer --> removeAll sucessfull !!! ->\"+JSON.stringify(data));\r\n\t\t\t\t\t\t//FL.API  var convertOneRecordTo_arrToSend\r\n\t\t\t\t\t\t// var arrToSend = csvStore.extractFromCsvStoreWith_Id();  //convertRecordsTo_arrToSend in FLAPI\r\n\t\t\t\t\t\tvar arrToSend = csvStore.extractFromCsvStore();\r\n\t\t\t\t\t\tif(arrToSend.length!=data.count)\r\n\t\t\t\t\t\t\talert(\"FL.grid.updateCurrentCSVToServer - a c'est pas bon --->arrToSend.length=\"+arrToSend.length+ \" vs data.count=\"+ data.count );\t\t\t\r\n\t\t\t\t\t\t// var insertAllPromise = FL.API._insert(eCN);\r\n\t\t\t\t\t\t//we NEED TO INTRODUCE _id at d:{} level and remove-it from \r\n\t\t\t\t\t\tvar insertAllPromise = FL.API.addRecordsToTable(entityName,arrToSend,true);//last parameter is withId to force the same Ids\r\n\t\t\t\t\t\tinsertAllPromise.done(function(data){\r\n\t\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\t\treturn def.resolve(data);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tinsertAllPromise.fail(function(err){\r\n\t\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\t\tFL.common.printToConsole(\"FL.grid.updateCurrentCSVToServer --> after successful remove ->FAILURE in insertAllPromise err=\"+err);\r\n\t\t\t\t\t\t\treturn def.reject(err);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tremoveAllPromise.fail(function(err){\r\n\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\tFL.common.printToConsole(\"FL.grid.updateCurrentCSVToServer --> after successful remove ->FAILURE in FL.API.saveTable err=\"+err);\r\n\t\t\t\t\t\treturn def.reject(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn def.reject(\"FL.grid.updateCurrentCSVToServer --> \" + entityName + \" does not exist in Local Dictionary !\");\r\n\t\t\t\t}\r\n\t\t\t\treturn def.promise();\r\n\t\t\t},\t\t\t\t\r\n\t\t   \tcsvToGrid: function(csvFile){//input is a JQuery object (a file representation). Ex var csvFile = $('input[type=file]');\r\n\t\t        csvFile.parse({//http://papaparse.com/  \r\n\t\t            config: {\r\n\t\t               // base config to use for each file\r\n\t\t               encoding:\"ISO-8859-1\" // ISO-8859-1 is the good encoding for Portuguese chars  - \"UTF-8\" or \"utf-8\", \"latin-1\", \"windows-1255\"\r\n\t\t               // encoding:\"\" // ISO-8859-1 is the good encoding for Portuguese chars  - \"UTF-8\" or \"utf-8\", \"latin-1\", \"windows-1255\"\r\n\t\t            },\r\n\t\t            before: function(file,inputElem) {\r\n\t\t                // alert(\"file name=\"+file.name);\r\n\t\t                // alert(\"inputElem=\"+inputElem);\r\n\t\t             },\r\n\t\t            checkData: function(data){//returns true if columns are ok..false otherwise\r\n\t\t                // alert(\"Before Cleaning -->\"+JSON.stringify(data.results.fields));\r\n\t\t                var xRet = true;\r\n\t\t                _.each(data.results.fields,function(element){\r\n\t\t                    if(element === \"\")\r\n\t\t                        xRet = false;\r\n\t\t                });\r\n\t\t                return xRet;\r\n\t\t            },\r\n\t\t            complete: function(data) {\r\n\t\t                // data is an object data = {errors:{}, meta:{}, results:{fields:[ elements are fields],rows:[elements are objects]} } \r\n\t\t                // data.results.fields - array with columns titles to show\r\n\t\t                // data.results.rows - an array of JSON [{},{}...{}]; each JSON  has a key/value = attribute/content\r\n\t\t                //     eventualy key names have upper case chars ->if columnsArr is provided by \r\n\t\t                //       method utils.backGridColumnsExtractedFromDictionary() they will be converted to lower case only\r\n\t\t                //     eventually id will be missing among key names -  FL.grid.csvToStore() will inject id into csvStore\r\n\t\t                \r\n\t\t                //now we pass this entity to the data dictionary. Then the data dictionary will feed the grid columns\r\n\t\t                // csvStore.currentGridCandidate[\"entityName\"] = entityName;\r\n\t\t                // var entityName = utils.createEntityFromCsvAnalisys(data.results.rows);\r\n\t\t                // FL.dd.displayEntities();\r\n\t\t                // var columnsArr2 = utils.backGridColumnsExtractedFromDictionary(entityName);//extracts attributes from dictionary and prepares columns object for backgrid\r\n\t\t                \r\n\r\n\t\t                // this is an alternative without creating any entry in data dictionary\r\n\t\t                // to use backGridColumnsFromArray() we need arrOfColumns with format: [{label:\"xx\",name:fieldName,type:xtype,enumerable:xEnumerable},{col2}...{}]\r\n\t\t                //  to get arrOfColumns we need a method similar to  createEntityFromCsvAnalisys(rows)\r\n\t\t                \r\n\t\t                //in some cases data.result.fields has an empty field\r\n\t\t                if(!this.checkData(data)){\r\n\t\t                    alert(\"Csv has a problem. Verify columns that have content but title is missing. Please suply a title or remove content.\");\r\n\t\t                    return;\r\n\t\t                }\r\n\t\t                var arrOfColumns =  createAttributesArrFromCsvAnalisys(data.results.rows);//returns all coluns from CSV\r\n\t\t                injectId(\"id\",arrOfColumns); //now the first column is an \"id\" column \r\n\t\t                var columnsArr = utils.backGridColumnsFromArray(arrOfColumns);//extracts attributes from dictionary and prepares columns object for backgrid\r\n\r\n\t\t                FL.common.printToConsole(\"columns defined...\");\r\n\t\t                var columnsArr2 = [//columns definition to mountGrid - Manual equivalent  to utils.backGridColumnsExtractedFromDictionary()\r\n\t\t                    {label:\"Order\",name:\"id\",type:\"string\",enumerable:null},\r\n\t\t                    {label:\"Col1\",name:\"f1\",type:\"string\",enumerable:null},\r\n\t\t                    {label:\"Col2\",name:\"f2\",type:\"string\",enumerable:null},\r\n\t\t                    {label:\"Col3\",name:\"f3\",type:\"enumerable\",enumerable:[\"A\",\"B\",\"C\"]},\r\n\t\t                    // {label:\"Col4\",name:\"f4\",type:\"number\",enumerable:null}\r\n\t\t                    {label:\"Col4\",name:\"f4\",type:\"number\",enumerable:null}\r\n\t\t                ];\r\n\t\t                var rowsArr2 = [\r\n\t\t                    {id:1,f1:\"abcd Lda\", f2:\"Av Mortirmer 12\",  f3:\"C\",f4:225},\r\n\t\t                    {id:2,f1:\"Jua Lda\",  f2:\"Dr Vaquero 5\",     f3:\"A\",f4:322},\r\n\t\t                    {id:3,f1:\"Moe Corp\", f2:\"Latham Street 24C\",f3:\"A\",f4:242},\r\n\t\t                    {id:4,f1:\"Zuka\",     f2:\"123, Zuka Build.5\",f3:\"B\",f4:357},\r\n\t\t                    {id:5,f1:\"One World\",f2:\"One way street 23\",f3:\"A\",f4:196},\r\n\t\t                    {id:6,f1:\"Moe Corp\", f2:\"Latham Street 24C\",f3:\"A\",f4:242},\r\n\t\t                    {id:7,f1:\"ZumZum\",   f2:\"Vitesse Road.5\",   f3:\"B\",f4:357},\r\n\t\t                    {id:8,f1:\"2nd Lab\",  f2:\"Two way street 57\",f3:\"A\",f4:196},\r\n\t\t                    {id:9,f1:\"Moe Corp\", f2:\"Latin America 1\",  f3:\"A\",f4:242},\r\n\t\t                    {id:10,f1:\"Zukerman\",f2:\"29,Zukerman Bld.7\",f3:\"B\",f4:357},\r\n\t\t                    {id:11,f1:\"third A\", f2:\"One Str, 632\",     f3:\"A\",f4:196}\r\n\r\n\t\t                 ];\r\n\t\t                // columnsArr - columns definition to mountGrid has the format: [{label:\"xx\",name:fieldName,type:xtype,enumerable:xEnumerable},{col2}...{}]\r\n\t\t                // columnsArr2 = utils.backGridColumnsFromArray(columnsArr2);\r\n\t\t                csvStore.setAttributesArr(arrOfColumns);\r\n\t\t                FL.grid.csvToStore(data.results.rows); //feeds the csvStore data store object. It inserts id element and converts keys to lowercase\r\n\t\t                \r\n\t\t                utils.mountGridInCsvStore(columnsArr);//mount backbone views and operates grid - columnsArr must be prepared to backGrid\r\n\t\t                // to prepare columnArr to backGrid use utils.backGridColumnsExtractedFromDictionary() or backGridColumnsFromArray()\r\n\t\t                // utils.mountGridInCsvStore(columnsArr2);//mount backbone views and operates grid - columnsArr must be prepared to backGrid\r\n\t\t\t\t\t}\r\n\t\t        });\r\n\t\t    },\r\n\t\t\tremoveLastRowIfIncomplete: function (data){\r\n\t\t\t\t//by some unknown reason papaparse may leave a last row incomplete....\r\n\t\t\t\t//to prevent the existence of an incomplete last line. We will check if last line has the rigth number of columns if not we remove it\r\n\t\t\t\tvar lastRowIndex = data.data.length - 1;\r\n\t\t\t\tvar lastLineObj = data.data[lastRowIndex];\r\n\t\t\t\tvar totColsPerRow = data.meta.fields.length;\r\n\t\t\t\tvar lastLineCols = ( _.values(lastLineObj) ).length;\r\n\t\t\t\tif (lastLineCols != totColsPerRow)\r\n\t\t\t\t\tdata.data.splice(lastRowIndex, 1);\t\t\t\r\n\t\t\t},\r\n\t   \t\tcsvToGrid2: function(csvFile,delimiter,encoding,entityName){//input is a file object obtained from DOM\t//http://papaparse.com/  \r\n\t\t\t\t\t\t//csvFile - file to load file from local computer\r\n\t\t\t\t\t\t//delimiter - eventual delimiter to use instead of auto delimiter. This is decided by onchange=\"FL.grid.validateCSV(this.files)\"\r\n\t\t\t\t\t\t// var spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\t\t\t\t\tvar thiz = this;\r\n\t\t\t\t\t\tskipEmptyLines = true;\r\n\t\t\t\t\t\tif(!delimiter){\r\n\t\t\t\t\t\t\tdelimiter = \"\";//this is the default =>autodetect\r\n\t\t\t\t\t\t\tskipEmptyLines = false;//this is the default\r\n\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\tPapa.parse(csvFile, {\r\n\t\t\t\t        \theader: true,\r\n\t\t\t\t\t\t\tdynamicTyping: true,//If true, numeric and boolean data will be converted to their type instead of remaining strings.\r\n\t\t\t\t\t\t\t\t\t\t\t\t//Numeric data must conform to the definition of a decimal literal. (European-formatted numbers must have commas and dots swapped.)\r\n\t\t\t\t\t\t\t\t\t\t\t\t//Papa parse don't know how to automatically detect if the number is American- or European-formatted. \r\n\t\t\t\t\t\t\tdelimiter: delimiter,\r\n\t\t\t\t\t\t\tskipEmptyLines: skipEmptyLines,\r\n\t\t\t\t\t\t\t// encoding:\"ISO-8859-1\",// ISO-8859-1 is the good encoding for Portuguese chars  - \"UTF-8\" or \"utf-8\", \"latin-1\", \"windows-1255\"\r\n\t\t\t\t            encoding: encoding, //defined in verifyPapaFields()\r\n\t\t\t\t            complete: function(data) {\r\n\t\t\t\t                // data is an object data = {errors:{}, meta:{}, results:{fields:[ elements are fields],rows:[elements are objects]} } \r\n\t\t\t\t                // data.results.fields - array with columns titles to show\r\n\t\t\t\t                // data.results.rows - an array of JSON [{},{}...{}]; each JSON  has a key/value = attribute/content\r\n\t\t\t\t                //     eventualy key names have upper case chars ->if columnsArr is provided by \r\n\t\t\t\t                //       method utils.backGridColumnsExtractedFromDictionary() they will be converted to lower case only\r\n\t\t\t\t                //     eventually id will be missing among key names -  FL.grid.csvToStore() will inject id into csvStore\r\n\t\t\t\t                \r\n\t\t\t\t                //Process: \r\n\t\t\t\t                //  removeLastRowIfIncomplete->Analyse CSV data to determine type of columns ->\r\n\t\t\t\t                //  ->Scan every line to adjust it to type ->save data.rows to csvStore ->mount and display grid ->\r\n\t\t\t\t                //  ->Store csvStore to Serverr and place menu titem to acess data from server.\r\n\t\t\t\t\t                \r\n\t\t\t\t\t\t\t\tthiz.removeLastRowIfIncomplete(data);//to remove eventual incomplete last line\r\n\t\t\t\t                var arrOfAttributes = dataRowAnalisys(data.data, 0.5);//row analisys returning array of attributes (one element per column) \r\n\t\t\t\t                // arrOfAttributes ->[attributeName1:{fieldType\":\"string\",\"fieldTypeUI\":\"textbox\",\"numberFormat\":null, enumerable:null,label:element},attributeName2{..}]\r\n\r\n\t\t\t\t                adjustRowsToAttributes(data.data,arrOfAttributes);//here we will adjust data.data according with the analisys feedback in arrOfColumns\r\n\r\n\t\t\t\t                var arrOfColumns =  translateToDDFormat(arrOfAttributes);//translates arrOfAttributes format to dd format\r\n\t\t\t\t                // returns an array with the same format as dd dictionary array of attributes. Each element has the following format:\r\n\t\t\t        \t\t\t//   ex: {name:\"address\",description:\"address to send invoices\",label:\"Address\",type:\"string\",enumerable:null,key:false});\t\t                \r\n\r\n\t\t\t\t                // injectId(\"id\",arrOfColumns); //now the first column is an \"id\" column \r\n\t\t\t\t                injectId(\"#\",arrOfColumns); //now the first column is an \"id\" column \r\n\r\n\t\t\t\t                csvStore.setAttributesArr(arrOfColumns);\r\n\t\t\t\t                FL.grid.csvToStore(data.data); //feeds the csvStore data store object. It inserts id element and converts keys to lowercase\r\n\t\t\t\t                \r\n\t\t\t\t                var columnsArr = utils.backGridColumnsFromArray(arrOfColumns);//extracts attributes from dictionary and prepares columns object for backgrid\r\n\t\t\t\t               \tFL.common.printToConsole(\"columns defined...\"+JSON.stringify(columnsArr));\r\n\t\t\t\t                \r\n\t\t\t\t                utils.mountGridInCsvStore(columnsArr);//mount backbone views and operates grid - columnsArr must be prepared to backGrid\r\n\t\t\t\t                // to prepare columnArr to backGrid use utils.backGridColumnsExtractedFromDictionary() or backGridColumnsFromArray()\r\n\t\t\t\t                // utils.mountGridInCsvStore(columnsArr2);//mount backbone views and operates grid - columnsArr must be prepared to backGrid\r\n\t\t\t\t                // FL.grid.storeCurrentCSVToServerAndInsertMenu(entityName);//the \r\n\t\t\t\t\t\t\t\tvar promise = FL.grid.storeCurrentCSVToServerAndInsertMenu(entityName);\r\n\t\t\t\t\t\t\t\tpromise.done(function(){\r\n\t\t\t\t\t\t\t\t\tFL.grid.displayDefaultGrid(entityName);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tpromise.fail(function(err){\r\n\t\t\t\t\t\t\t\t\talert(\"FLgrid2.js csvToGrid2 Error:\"+err);\r\n\t\t\t\t\t\t\t\t});\t\t\t\t\t                \r\n\t\t\t\t                // spinner.stop();\r\n\t\t\t\t            }\r\n\t\t        \t\t});\r\n\t\t    },\t\t    \r\n\t\t\tdisplayDefaultGrid: function(entityName) { //loads entity from server and display the grid with add,del,edit grid buttons at left and newsletter if a email field exist\r\n\t\t\t\t//condition to execute is: FL.API.serverCallBlocked = false;\t\r\n\t\t\t\tentityName = entityName.replace(/_/g,\" \");\r\n\t\t\t\tvar spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\t\t\t\r\n\t\t\t\tvar promiseUnblock = FL.API.checkServerCallBlocked()\r\n\t\t\t\t.then(function(){\r\n\t\t\t\t\tFL.API.serverCallBlocked = true;\r\n\t\t\t\t\tvar promise=FL.API.loadTable(entityName);\r\n\t\t\t\t\tpromise.done(function(data){\r\n\t\t\t\t\t\tFL.common.printToConsole(\"New %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\");\r\n\t\t\t\t\t\tcsvStore.setEntityName(entityName);//stores <entityName> in csvStore object \r\n\t\t\t\t\t\tcsvStore.store(data);//data is an array of objects [{},{},....{}] where id field is mandatory inside {}\r\n\t\t\t\t\t\tvar z=csvStore.csvRows;//only for debugging\r\n\t\t\t\t\t\tFL.common.printToConsole(\"show csvStore=\"+JSON.stringify(csvStore.csvRows));\r\n\r\n\t\t\t\t\t\tvar eCN = FL.dd.getCEntity(entityName);//to remove later when we change entityName by eCN\r\n\t\t\t\t\t\tvar gridLayout = FL.bg.getGridDefaultLayout(eCN);\r\n\t\t\t\t\t\t//gridLayout={baseTable:\"5M\",format:[{fCN:\"50\",label:\"1st Column\",width:20,nestingArr:[]},{fCN:\"5P\",label:\"2st Column\",width:30,nestingArr:[]},\r\n\t\t\t\t\t\t//\t\t\t{fCN:\"5Q\",label:\"3st Column\",width:10,nestingArr:[]}] }\r\n\t\t\t\t\t\tvar lookupObj = getLookupInGrid(gridLayout);\r\n\t\t\t\t\t\tif(lookupObj){\r\n\t\t\t\t\t\t\tconsole.log(\"1367 Lookup !\");\t\t\t\t\r\n\t\t\t\t\t\t\tvar eCN = lookupObj.eCN; //\"6A\";//field.specialTypeDef.eCN;\r\n\t\t\t\t\t\t\tvar openPromise = FL.API.openTable(eCN);\r\n\t\t\t\t\t\t\topenPromise.done(function(dataArray){\r\n\t\t\t\t\t\t\t\tFL.common.printToConsole(\">>>>>displayDefaultGrid openTable SUCCESS <<<<< \",\"API\");\r\n\t\t\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\t\t\tvar columnsArr = FL.bg.setupGridColumnsArr(gridLayout,dataArray);\r\n\t\t\t\t\t\t\t\tmountGridFromColumnsArr(columnsArr,eCN);\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\topenPromise.fail(function(err){FL.common.printToConsole(\">>>>>displayDefaultGrid openTable FAILURE <<<<<\"+err,\"API\");def.reject(err);});\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tconsole.log(\"1369 no lookup !\");\r\n\t\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\t\tvar columnsArr = FL.bg.setupGridColumnsArr(gridLayout);\r\n\t\t\t\t\t\t\tmountGridFromColumnsArr(columnsArr,eCN);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpromise.fail(function(err){\r\n\t\t\t\t\t\tFL.API.serverCallBlocked = false;\r\n\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\talert(\"DefaultGridWithNewsLetterAndEditButtons Error=\"+err);\r\n\t\t\t\t\t});\t\t\t\t\r\n\t\t\t\t}, function(err){ alert(\"FL.grid.displayDefaultGrid ERROR: Please try again !\" + err); } );\t\t\t\r\n\t\t\t},\r\n\t\t\tdisplayDefaultGrid2: function(entityName) { //loads entity from server and display the grid with add,del,edit grid buttons at left and newsletter if a email field exist\r\n\t\t\t\tvar def = $.Deferred();\r\n\t\t\t\tentityName = entityName.replace(/_/g,\" \");\r\n\t\t\t\t// FL.common.spin(true);\r\n\r\n\t\t\t\tvar spinner=FL.common.loaderAnimationON('spinnerDiv');\r\n\t\t\t\tvar promiseUnblock = FL.API.checkServerCallBlocked()\r\n\t\t\t\t.then(function(){//this only occurs when checkServerCallBlocked is resolved\r\n\t\t\t\t\tvar promise=FL.API.loadTable(entityName);\r\n\t\t\t\t\tpromise.done(function(data){\r\n\t\t\t\t\t\tcsvStore.setEntityName(entityName);//stores <entityName> in csvStore object \r\n\t\t\t\t\t\tcsvStore.store(data);//data is an array of objects [{},{},....{}] where id field is mandatory inside {}\r\n\t\t\t\t\t\tFL.common.printToConsole(\"FL.grid.displayDefaultGrid2 -->loadTable is done\");FL.common.printToConsole(\"show csvStore=\"+JSON.stringify(csvStore.csvRows));\r\n\t\t\t\t\t\tvar columnsArr = utils.backGridColumnsExtractedFromDictionary(entityName);//extracts attributes from dictionary and prepares columns object for backgrid\r\n\t\t\t\t\t\tFL.common.printToConsole(\"FL.grid.displayDefaultGrid2 &&&&&&&& entity=\"+entityName);FL.common.printToConsole(\"show columnsArr=\"+JSON.stringify(columnsArr));\r\n\t\t\t\t\t\tFL.common.clearSpaceBelowMenus();\r\n\t\t\t\t\t\t$(\"#addGrid\").show();$(\"#addGrid\").html(\" Add Row\");$('#_editGrid').off('click');$(\"#_editGrid\").click(function(){ editGrid(entityName);});\r\n\t\t\t\t\t\t$(\"#_editGrid\").show();\r\n\t\t\t\t\t\tif( FL.dd.isEntityWithTypeUI(entityName,\"emailbox\") || FL.dd.isEntityWithTypeUI(entityName,\"email\") ){//the newsletter option only appears to entities that have an email\r\n\t\t\t\t\t\t\t$('#_newsletter').off('click');\r\n\t\t\t\t\t\t\t$(\"#_newsletter\").click(function(grid){\r\n\t\t\t\t\t\t\t\tvar templatePromise=FL.API.createTemplates_ifNotExisting();\r\n\t\t\t\t\t\t\t\ttemplatePromise.done(function(){\r\n\t\t\t\t\t\t\t\t\tprepareNewsletterEmission(entityName,grid);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\ttemplatePromise.fail(function(err){\r\n\t\t\t\t\t\t\t\t\talert(\"FL.grid.displayDefaultGrid2 ->FAILURE with createTemplates_ifNotExisting err=\"+err);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$('#_newsletter').show();$('#_newsletterMC').off('click');$(\"#_newsletterMC\").click(function(){prepareNewsletterMCEmission(entityName);});\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t$('#_newsletterMC').show();$(\"#_newsletterMC\").html(\" MC\");\r\n\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\tutils.mountGridInCsvStore(columnsArr);//mount backbone views and operates grid -\t\r\n\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\treturn def.resolve();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpromise.fail(function(err){\r\n\t\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\t\treturn def.reject(\"FL.grid.displayDefaultGrid2 failure on loadTable \"+err);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, function(err){\r\n\t\t\t\t\tspinner.stop();\r\n\t\t\t\t\treturn def.reject(\"FL.grid.displayDefaultGrid2 failure on checkServerCallBlocked() \"+err);\r\n\t\t\t\t});\r\n            \treturn def.promise();\r\n\t\t\t},\r\n\t\t\tsendEmailTest: function() {//sends a sample email with eMail/newsletter\r\n\t\t\t\tif(FL.login.emailContentTemplate){\r\n\t\t\t\t\t// var mailHTML = '<p>Thank you for selecting <a href=\"http://www.framelink.co\"><strong>FrameLink version 8</strong></a> to build your backend site !</p>';\t\t\t\r\n\t\t\t\t\tvar mailHTML = FL.login.emailContentTemplate;\r\n\t\t\t\t\tvar imagesArr = FL.login.emailImagesArray;\r\n\t\t\t\t\tvar senderObj = extractSenderObjFromModal();\r\n\t\t\t\t\t// var toArr = [{\"email\":testEmail}];\r\n\t\t\t\t\tvar toArr = [senderObj.testEmail];\r\n\t\t\t\t\tvar metadataObj={newsletterName:\"test\",dbName:\"test\",eCN:null,fCN:null}\r\n\r\n\t\t\t\t\tFL.common.printToConsole(\"Sends test email to from_name:\"+senderObj.from_name+\" email:\"+senderObj.from_email+\" subject:\"+senderObj.subject);\r\n\t\t\t\t\tFL.common.printToConsole(\"Sends to -->\"+JSON.stringify(toArr));\r\n\t\t\t\t\tFL.common.printToConsole(\"Sends HTML -->\"+mailHTML);\r\n\t\t\t\t\tFL.common.printToConsole(\"----------------------------------------------------------------------\");\r\n\t\t\t\t\t// FL.links.sendEmail(null,mailHTML,imagesArr,toArr,senderObj,\"test\");\r\n\t\t\t\t\t// FL.emailServices.sendEmail(null,mailHTML,imagesArr,toArr,senderObj,\"test\",\"test\");//2 last param: FL.login.emailTemplateName,FL.login.token.dbName\r\n\t\t\t\t\tFL.emailServices.sendEmail(mailHTML,imagesArr,toArr,senderObj,metadataObj);\r\n\t\t\t\t\t// alert(\"Email test sent to \"+senderObj.testEmail);\r\n\t\t\t\t\tFL.common.makeModalInfo(\"Test Email sent to \"+senderObj.testEmail,null,2);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// alert(\"Email content is empty - choose a template and try again \");\r\n\t\t\t\t\tFL.common.makeModalInfo(\"Email content is empty - choose a template and try again\",null,2);\r\n\t\t\t\t}\r\n\t\t\t\tif(FL.common.getBrowser() == \"ie\"){\r\n\t        \t\tvar elem = document.getElementById('form__sendNewsletterTemplate_emailTest');\r\n           \t\t\telem.parentNode.removeChild(elem);\r\n\t        \t}\r\n\t\t\t},\t\t\t\r\n\t\t\ttestFunc: function(x) {\r\n\t\t\t\talert(\"FL.grid.test() -->\"+x);\r\n\t\t\t}\r\n\t\t};\r\n\t})();\r\n// });"]}